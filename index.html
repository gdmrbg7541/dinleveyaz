<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinle ve Yaz | Ø§ÙØ³Ù’ØªÙÙ…ÙØ¹Ù’ ÙˆÙØ§ÙƒÙ’ØªÙØ¨Ù’</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Harmattan:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --font-poppins: 'Poppins', sans-serif;
            --font-harmattan: 'Harmattan', Arial, sans-serif;
            /* Renkler Ã¶nceki gibi */
            --color-bg: #f0f7ff;
            --color-surface: #ffffff;
            --color-shadow-light: #ffffff;
            --color-shadow-dark: #c2d9f0;
            --color-text-primary: #2d3142;
            --color-text-secondary: #7b88a1;
            --color-accent-1: #f3722c;
            --color-accent-2: #f8961e;
            --color-selected-bg: var(--color-accent-1);
            --color-selected-text: #ffffff;
            --color-correct: #90be6d;
            --color-error: #f94144;
            --color-correct-light: #edf7e7;
            --color-error-light: #feeaea;
            --color-score: #fca311;
            --border-radius-main: 1.2rem;
            --border-radius-small: 0.8rem;
        }

        html {
            font-size: min(calc(100vw / 120), calc(100dvh / 67.5));
            overflow: hidden;
        }

        body {
            font-family: var(--font-poppins); background: var(--color-bg); color: var(--color-text-primary); margin: 0; padding: 0;
            display: flex; justify-content: center; align-items: center;
            height: 100vh; height: 100dvh; overflow: hidden;
        }

        #gameWrapper {
            width: 120rem; height: 67.5rem; position: relative;
            overflow: hidden; background: var(--color-bg);
            box-shadow: 0 0 2rem rgba(0,0,0,0.15);
        }

        .screen {
            width: 100%; height: 100%; max-width: none; max-height: none;
            position: absolute; top: 0; left: 0; margin: auto;
            background-color: transparent; border-radius: 0; box-shadow: none; border: none;
            padding: 2rem; box-sizing: border-box;
            display: none; flex-direction: column; align-items: center; justify-content: flex-start;
        }
        .screen.active { display: flex; }

        #gameScreen, #scoreScreen { flex-grow: 1; min-height: 0; width: 100%; justify-content: space-between; overflow: hidden; }
        #homeScreen { text-align: center; justify-content: center; }

        .title-container { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 0.5rem; margin-bottom: 2rem; flex-shrink: 0;}
        .title-text h1 { font-size: 4.5rem; color: var(--color-accent-1); margin: 0; font-family: var(--font-poppins); text-shadow: 1px 1px 2px var(--color-shadow-dark); }
        .title-text h2 { font-size: 3.5rem; font-weight: 700; color: var(--color-text-primary); margin: 0; text-shadow: 1px 1px 1px var(--color-shadow-light); font-family: var(--font-harmattan); }
        #homeScreen h3 { font-size: 2.2rem; font-family: var(--font-poppins); color: var(--color-text-secondary); padding-bottom: 0.5rem; margin-top: 1rem; font-weight: 600; border-bottom: 2px solid var(--color-accent-1); margin-bottom: 1.5rem; flex-shrink: 0; width: auto; display: inline-block;}
        #levelSelect { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; width: 100%; max-width: 45rem; margin: 0 auto 1rem; flex-shrink: 0;}

        .key-button {
            padding: 0.8rem 1rem; font-size: 1rem; font-weight: 600; font-family: inherit;
            border: none; border-radius: var(--border-radius-small); cursor: pointer;
            transition: all 0.2s ease-out; color: var(--color-text-primary);
            background: var(--color-surface);
            box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light);
            display: inline-flex; justify-content: center; align-items: center;
            line-height: 1.2; vertical-align: middle; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
        }
        .key-button:active:not(:disabled) { box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light); transform: scale(0.98); }
        .key-button:hover:not(:disabled) { color: var(--color-accent-1); }
        .level-btn { font-size: 1.8rem; padding: 1.2rem 1.8rem; font-weight: 700;}
        .level-btn.selected { background: var(--color-selected-bg); color: var(--color-selected-text); box-shadow: inset 3px 3px 6px #d15a1a, inset -3px -3px 6px #ff8a3e; transform: none; }
        .action-btn { font-size: 1.3rem; border-radius: var(--border-radius-small); padding: 0.8rem 1.5rem; }

        .back-button {
            font-size: 1.5rem; width: 4rem; height: 4rem; padding: 0; color: var(--color-text-secondary); background: var(--color-surface);
            border: none; display: inline-flex; justify-content: center; align-items: center; cursor: pointer; border-radius: var(--border-radius-small);
            box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light); transition: all 0.2s ease-out;
        }
        .back-button::before { content: ''; display: inline-block; width: 0.8em; height: 0.8em; border-top: 0.3em solid currentColor; border-left: 0.3em solid currentColor; transform: rotate(-45deg); margin-right: 0.2em; }
        .back-button:active:not(:disabled) { box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light); transform: scale(0.98); }
        .back-button:hover:not(:disabled) { color: var(--color-accent-1); }

        #scoreToHomeButton { font-size: 1.5rem; width: auto; min-width: 5rem; height: 4rem; padding: 0 1.5rem; margin: 1.5rem auto 0; display: block; color: var(--color-text-secondary); background: var(--color-surface); }
        #scoreToHomeButton:hover:not(:disabled) { color: var(--color-accent-1); }

        #gameHeader { position: relative; display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.5rem; border-bottom: none; margin-bottom: 0.5rem; flex-shrink: 0; padding-left: 0; padding-right: 0; width: 100%; max-width: 45rem; margin-left: auto; margin-right: auto; }
        .header-info { font-size: 1.5rem; font-weight: 600; font-family: var(--font-poppins); background: var(--color-surface); padding: 0.5rem 1rem; border-radius: var(--border-radius-small); box-shadow: 2px 2px 4px var(--color-shadow-dark), -2px -2px 4px var(--color-shadow-light);}
        #levelScoreDisplay { color: var(--color-score); font-weight: 700; }
        #timerDisplay { color: var(--color-error); font-weight: 700; font-size: 1.7rem;}
        #mistakeCounter { color: var(--color-error); font-size: 2rem; letter-spacing: 2px; margin-left: 0.5rem; margin-right: 0.5rem; background: none; box-shadow: none; padding: 0;}
        .game-main { text-align: center; flex-grow: 1; display: flex; flex-direction: column; align-items: center; justify-content: center; min-height: 0; padding: 0; width: 100%; overflow: hidden; }
        #gameContent { display: flex; flex-direction: column; align-items: center; justify-content: center; gap: 0.8rem; width: 100%; max-width: 40rem; margin: auto; }
        #turkishWord, #arabicOutputContainer { padding: 0.5rem 1rem; min-height: auto; display: flex; align-items: center; position: relative; background: var(--color-surface); border: none; border-radius: var(--border-radius-main); box-shadow: inset 3px 3px 6px var(--color-shadow-dark), inset -3px -3px 6px var(--color-shadow-light); width: 100%; text-align: center; justify-content: center; flex-basis: auto; box-sizing: border-box; flex-shrink: 0; line-height: 1.3; overflow: hidden; word-break: break-all; }
        #turkishWord { order: 3; font-size: 4rem; margin-top: 0; margin-bottom: 0; font-family: var(--font-poppins); font-weight: 600; color: var(--color-text-primary); }
        #arabicOutputContainer { order: 1; gap: 0.5rem; direction: rtl; background: var(--color-surface); margin-bottom: 0; }
        
        /* GÃœNCELLENDÄ°: ArapÃ§a font boyutu yatayda 6rem'e bÃ¼yÃ¼tÃ¼ldÃ¼ */
        #arabicOutputDisplay { width: auto; max-width: 100%; white-space: normal; font-family: var(--font-harmattan); font-weight: 700; line-height: 1.3; border: none; background: none; padding: 0; box-shadow: none; direction: rtl; cursor: default; font-size: 6rem; transition: none; color: var(--color-text-primary); }
        
        #arabicOutputDisplay[lang="ar"] { font-family: var(--font-harmattan); /* Ekstra gÃ¼vence */ }
        #arabicOutputDisplay.empty::before { content: '...'; color: var(--color-text-secondary); font-weight: normal; font-size: 1.5rem; opacity: 0.8; width: 100%; text-align: center;}
        #correctAnswerContainer, #correctAnswerDisplay, #helperGrid, .char-btn, .separator, .tool-btn-danger, #checkButton { display: none !important; }

        #letterBankContainer { order: 2; overflow-y: auto; padding: 0.2rem; margin: 0; width: 100%; box-sizing: border-box; max-width: 100%; display: flex; align-items: center; justify-content: center; min-height: auto; flex-shrink: 0; }
        #letterBank { display: flex; flex-direction: row; flex-wrap: wrap; gap: 0.4rem; align-items: center; justify-content: center; padding: 0; max-width: 100%; margin: 0 auto; }
        .letter-bank-btn { font-family: var(--font-harmattan); /* ArapÃ§a fontu uygula */ font-weight: 700; font-size: 4rem; width: 5rem; height: 5rem; padding: 0.3rem 0; margin: 0.2rem; background: var(--color-surface); color: var(--color-text-primary); border: none; box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light); border-radius: 0.8rem; transition: all 0.1s ease-out; line-height: 1; vertical-align: middle; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; cursor: pointer; flex-shrink: 0; box-sizing: border-box; }
        .letter-bank-btn[lang="ar"] { font-family: var(--font-harmattan); /* Ekstra gÃ¼vence */ }
        .letter-bank-btn:active:not(:disabled) { box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light); transform: scale(0.97); }
        .letter-bank-btn.hareke-char { font-size: 3rem; }
        .letter-bank-btn.correct-form { background-color: var(--color-correct-light) !important; color: var(--color-correct) !important; box-shadow: inset 2px 2px 4px #76b198, inset -2px -2px 4px #baffa0 !important; cursor: default; transform: none !important; }
        .letter-bank-btn.error-form { background-color: var(--color-error-light) !important; color: var(--color-error) !important; box-shadow: inset 2px 2px 4px #d35f61, inset -2px -2px 4px #ff8386 !important; animation: shake 0.3s ease-in-out; transform: none !important; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        #audioControl { display: flex; position: relative; width: 4.5rem; height: 4rem; /* Sabit boyut */ }
        #audioControl button, #nextButton {
             position: absolute; /* ButonlarÄ± Ã¼st Ã¼ste bindir */
             top: 0; left: 0; /* AynÄ± konuma yerleÅŸtir */
             font-size: 2.5rem; width: 100%; height: 100%; padding: 0; /* Konteyneri doldur */
             color: var(--color-selected-text); background: var(--color-accent-1);
             border: none; border-radius: var(--border-radius-small);
             box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light);
             transition: all 0.2s ease-out, opacity 0.3s, visibility 0.3s;
             display: inline-flex; justify-content: center; align-items: center; /* Ä°Ã§eriÄŸi ortala */
        }
        #audioControl button:hover:not(:disabled), #nextButton:hover:not(:disabled) { background: var(--color-accent-2); color: var(--color-selected-text); }
        #audioControl button:active:not(:disabled), #nextButton:active:not(:disabled) { box-shadow: inset 2px 2px 4px #d15a1a, inset -2px -2px 4px #ff8a3e; transform: scale(0.98); }
        #audioControl button.hidden, #nextButton.hidden { opacity: 0; visibility: hidden; pointer-events: none; }

        @keyframes blink { 0% { opacity: 1; transform: scale(1); box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light), 0 0 10px var(--color-accent-2); } 50% { opacity: 0.8; transform: scale(1.03); box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light), 0 0 20px 5px var(--color-accent-1); } 100% { opacity: 1; transform: scale(1); box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light), 0 0 10px var(--color-accent-2); } }
        .blinking-button { animation: blink 1.2s infinite ease-in-out; }
        :disabled { background: var(--color-surface) !important; color: var(--color-text-secondary) !important; box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light) !important; cursor: not-allowed !important; transform: none !important; opacity: 0.7 !important; }
        .letter-bank-btn.correct-form:disabled { background-color: var(--color-correct-light) !important; color: var(--color-correct) !important; box-shadow: inset 2px 2px 4px #76b198, inset -2px -2px 4px #baffa0 !important; opacity: 0.8 !important; }
        #gameFooter { text-align: center; flex-shrink: 0; padding-top: 0.8rem; margin-top: 0.5rem; border-top: none; display: flex; justify-content: space-between; align-items: center; width: 100%; padding-left: 0; padding-right: 0; max-width: 45rem; margin-left: auto; margin-right: auto; }
        #pointsBurst { position: absolute; top: 0.5rem; left: 5.5rem; font-size: 1.2rem; font-weight: bold; color: var(--color-score); opacity: 0; pointer-events: none; white-space: nowrap; background: var(--color-surface); padding: 0.3rem 0.6rem; border-radius: 5px; box-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        #pointsBurst.active { animation: points-burst 0.8s ease-out forwards; }
        @keyframes points-burst { 0% { transform: translateY(0) scale(0.8); opacity: 1; } 50% { transform: translateY(-15px) scale(1.1); opacity: 0.9; } 100% { transform: translateY(-30px) scale(0.9); opacity: 0; } }
        #scoreScreen { align-items: center; justify-content: center; text-align: center; padding: 1.5rem; }
        #scoreScreen h2 { font-size: 2.5rem; color: var(--color-accent-1); margin-bottom: 1rem; text-shadow: 1px 1px 2px var(--color-shadow-dark);}
        #scoreScreen p { font-size: 1.8rem; color: var(--color-text-primary); margin-bottom: 1.5rem; }
        #finalScoreValue { font-weight: bold; color: var(--color-score); } #totalPossibleScore { color: var(--color-text-secondary); }
        #incorrectList { width: 100%; max-width: 25rem; margin-top: 1rem; border-top: 1px solid var(--color-shadow-dark); padding-top: 1rem; text-align: left; }
        #incorrectList h3 { font-size: 1.3rem; color: var(--color-error); margin-bottom: 0.5rem; text-align: center; }
        #incorrectList ul { list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto; }
        #incorrectList li { font-size: 1.1rem; color: var(--color-text-primary); padding: 0.3rem 0.5rem; border-bottom: 1px dashed var(--color-shadow-dark); display: flex; justify-content: space-between; align-items: center; }
        #incorrectList li span:first-child { font-size: 1rem; color: var(--color-text-secondary); }
        #incorrectList li span:last-child { font-family: var(--font-harmattan); font-size: 1.5rem; font-weight: bold; margin-left: 0.5rem; direction: rtl; }
        #incorrectList li span:last-child[lang="ar"] { font-family: var(--font-harmattan); /* Ekstra gÃ¼vence */ }


        /* --- GÃœNCELLENDÄ°: Dinamik Harf SatÄ±rÄ± GeniÅŸlikleri (Yatay/VarsayÄ±lan) --- */
        #letterBankContainer.rows-2 #letterBank { max-width: 22rem; } /* 4/satÄ±r (5-8 harf) */
        #letterBankContainer.rows-3 #letterBank { max-width: 28rem; } /* 5/satÄ±r (9-10, 12-14 harf) */
        #letterBankContainer.rows-4 #letterBank { max-width: 28rem; } /* 5/satÄ±r (16+ harf) */
        #letterBankContainer.rows-5 #letterBank { max-width: 16rem; } /* 3/satÄ±r (15 harf) */
        #letterBankContainer.rows-11 #letterBank { max-width: 22rem; } /* 4/satÄ±r (11 harf -> 4-4-3) */
        /* --- --- */

        /* --- DÄ°KEY EKRAN (Telefon/Tablet) 540x960 ORANI --- */
        @media (orientation: portrait) {
            html { font-size: min(calc(100vw / 33.75), calc(100dvh / 60)); }
            #gameWrapper { width: 33.75rem; height: 60rem; }
            .screen { padding: 1rem; }
            .title-text h1 { font-size: 3.5rem; } .title-text h2 { font-size: 2.8rem; }
            #homeScreen h3 { font-size: 1.8rem; }
            #levelSelect { max-width: 100%; grid-template-columns: repeat(2, 1fr); gap: 0.8rem; }
            .level-btn { font-size: 1.5rem; padding: 1rem; }
            #gameHeader { max-width: 100%; flex-wrap: wrap; justify-content: center; gap: 0.5rem; }
            .header-info { font-size: 1.2rem; } #timerDisplay { font-size: 1.4rem; } #mistakeCounter { font-size: 1.5rem; }
            
            /* GÃœNCELLENDÄ°: Dikeyde boÅŸluk ve font boyutu arttÄ± */
            #gameContent { 
                max-width: 100%; 
                gap: 1rem; /* Minimum boÅŸluk */
                flex-grow: 1; /* Dikey alanÄ± doldur */
                justify-content: space-evenly; /* Ã–ÄŸeleri dikeyde eÅŸit daÄŸÄ±t */
            }
            #turkishWord { font-size: 3rem; }
            #arabicOutputDisplay { font-size: 5rem; } /* ArapÃ§a font boyutu dikeyde 5rem'e bÃ¼yÃ¼tÃ¼ldÃ¼ */

            #letterBankContainer { margin: 0; padding: 0.1rem; }
            #letterBank { gap: 0.2rem; max-width: 100%; }
            .letter-bank-btn { font-size: 2.5rem; width: 3.5rem; height: 3.5rem; margin: 0.1rem; border-radius: 0.5rem; padding: 0.2rem 0; }
            .letter-bank-btn.hareke-char { font-size: 2.2rem; }
            
            .back-button { width: 3.5rem; height: 3.2rem; font-size: 1.2rem; }
            .back-button::before{ width: 0.7em; height: 0.7em; border-width: 0.25em; }
            #audioControl { width: 3.5rem; height: 3.2rem; /* Boyutu eÅŸitle */}
            #audioControl button, #nextButton { font-size: 2rem; width: 100%; height: 100%; } /* Konteyneri doldur */
            #scoreScreen h2 { font-size: 2rem; } #scoreScreen p { font-size: 1.5rem; }
            #incorrectList { max-width: 100%; }
            #incorrectList li { font-size: 1rem; } #incorrectList li span:last-child { font-size: 1.3rem; }

            /* --- GÃœNCELLENDÄ°: Dikey iÃ§in dinamik satÄ±r geniÅŸlikleri (Yeni 3.5rem buton boyutuna gÃ¶re) --- */
            /* Dikey buton boyutu: 3.5rem + 0.2rem gap = ~3.7rem */
            #letterBankContainer.rows-2 #letterBank { max-width: 15rem; } /* 4/satÄ±r (5-8 harf) */
            #letterBankContainer.rows-3 #letterBank { max-width: 19rem; } /* 5/satÄ±r (9-10, 12-14 harf) */
            #letterBankContainer.rows-4 #letterBank { max-width: 19rem; } /* 5/satÄ±r (16+ harf) */
            #letterBankContainer.rows-5 #letterBank { max-width: 12rem; } /* 3/satÄ±r (15 harf) */
            #letterBankContainer.rows-11 #letterBank { max-width: 15rem; } /* 4/satÄ±r (11 harf -> 4-4-3) */
            
            /* GÃœNCELLENDÄ°: Ana EkranÄ± Dikeyde Yay */
            #homeScreen {
                justify-content: space-evenly;
            }
        }
    </style>
</head>
<body>

    <div id="gameWrapper">

        <div id="homeScreen" class="screen active">
             <div class="title-container">
                <div class="title-text">
                    <h1>Dinle Ve Yaz!</h1>
                    <h2>Ø§ÙØ³Ù’ØªÙÙ…ÙØ¹Ù’ ÙˆÙØ§ÙƒÙ’ØªÙØ¨Ù’</h2>
                </div>
            </div>
            <h3>Seviyeler</h3>
            <div id="levelSelect" class="button-grid">
                <button class="level-btn key-button" data-level="1">Seviye 1</button>
                <button class="level-btn key-button" data-level="2">Seviye 2</button>
                <button class="level-btn key-button" data-level="3">Seviye 3</button>
                <button class="level-btn key-button" data-level="4">Seviye 4</button>
                <button class="level-btn key-button" data-level="5">Seviye 5</button>
                <button class="level-btn key-button" data-level="6">Seviye 6</button>
                <button class="level-btn key-button" data-level="7">Seviye 7</button>
                <button class="level-btn key-button" data-level="8">Seviye 8</button>
            </div>
            </div>

        <div id="gameScreen" class="screen">
            <header id="gameHeader" class="game-header">
                <div id="levelScoreDisplay" class="header-info">Puan: 0</div>
                <div id="pointsBurst"></div>
                <div id="mistakeCounter" class="header-info"></div>
                <div id="timerDisplay" class="header-info">â±ï¸--s</div>
            </header>

            <main id="gameMain" class="game-main">
                <div id="gameContent">
                    <div id="arabicOutputContainer">
                        <div id="arabicOutputDisplay" class="arabic-output empty" dir="rtl" lang="ar"></div>
                    </div>
                    <div id="letterBankContainer">
                       <div id="letterBank"></div>
                    </div>
                    <div id="turkishWord">Kelime</div>
                </div>
            </main>

            <footer id="gameFooter" class="game-footer">
                <button id="backToHomeButton" class="back-button key-button"></button>
                <div id="audioControl">
                     <button id="playAudioButton" class="key-button">ğŸ§</button>
                     <button id="nextButton" class="key-button hidden">â¡ï¸</button>
                </div>
            </footer>
        </div>

        <div id="scoreScreen" class="screen">
            <h2 id="scoreTitle">Seviye TamamlandÄ±!</h2>
            <p id="singlePlayerScoreText">
                PuanÄ±nÄ±z: <span id="finalScoreValue">0</span> / <span id="totalPossibleScore">100</span>
            </p>
            <div id="incorrectList" style="display: none;">
                <h3>YanlÄ±ÅŸ Kelimeler:</h3>
                <ul id="incorrectWordsUl"></ul>
            </div>
            <button id="scoreToHomeButton" class="action-btn key-button">Ana MenÃ¼</button>
        </div>

    </div>

    <script>
        // --- Web Audio API Ses Sistemi ---
        let audioContext;
        let audioInitialized = false;

        function initAudioContext() {
            if (audioInitialized || !(window.AudioContext || window.webkitAudioContext)) {
                 if (!audioContext && (window.AudioContext || window.webkitAudioContext)) { console.warn("Web Audio API bu tarayÄ±cÄ±da desteklenmiyor."); }
                 return;
            }
            if (!audioContext) {
                try {
                    audioContext = new (window.AudioContext || window.webkitAudioContext)();
                    audioInitialized = true; console.log("AudioContext baÅŸlatÄ±ldÄ±."); unlockAudio();
                } catch (e) { console.error("Web Audio API baÅŸlatÄ±lamadÄ±.", e); audioInitialized = false; }
            }
        }

        function unlockAudio() {
             if (!audioContext || audioContext.state !== 'suspended') return;
             const buffer = audioContext.createBuffer(1, 1, 22050); const source = audioContext.createBufferSource();
             source.buffer = buffer; source.connect(audioContext.destination); source.start(0);
             audioContext.resume().then(() => { console.log("AudioContext kilidi aÃ§Ä±ldÄ± (state resumed)."); });
        }

        function playSound(soundKey) {
            if (!audioInitialized || !audioContext || audioContext.state !== 'running') {
                if (audioContext && audioContext.state === 'suspended') {
                    audioContext.resume().then(() => { console.log("AudioContext devam ettirildi:", soundKey); });
                } else { /* console.warn("Ses Ã§alma atlandÄ±", {key: soundKey, init: audioInitialized, state: audioContext?.state}); */ }
                return;
            }
            const sounds = {
                touch:     { f: 300,   t: 'sine',   d: 0.05 },
                correct:   { f: 523.25,t: 'sine',   d: 0.2 },
                incorrect: { f: 164.81,t: 'square', d: 0.2 }
            };
            const sound = sounds[soundKey]; if (!sound) { console.warn("Bilinmeyen ses:", soundKey); return; }
            try {
                const g = audioContext.createGain(); g.connect(audioContext.destination);
                g.gain.setValueAtTime(0, audioContext.currentTime);
                g.gain.linearRampToValueAtTime(0.1, audioContext.currentTime + 0.01);
                g.gain.linearRampToValueAtTime(0, audioContext.currentTime + sound.d);
                const o = audioContext.createOscillator(); o.type = sound.t;
                o.frequency.setValueAtTime(sound.f, audioContext.currentTime);
                o.connect(g); o.start(audioContext.currentTime); o.stop(audioContext.currentTime + sound.d);
            } catch (e) { console.error(`Ses (${soundKey}) hatasÄ±:`, e); }
        }
        // --- ---

        // --- GÃœNCELLENDÄ°: HatalÄ± karakterler temizlendi ---
        const gameData = {
             1: { timePerLetter: 8, words: [ { ar: "Ù†ÙØ¹ÙÙ…Ù’", base_ar:"Ù†Ø¹Ù…", tr: "Evet" }, { ar: "Ù‚ÙÙ„ÙÙ…Ù", base_ar:"Ù‚Ù„Ù…", tr: "Kalem" }, { ar: "Ù„ÙØ¹ÙØ¨Ù", base_ar:"Ù„Ø¹Ø¨", tr: "Oyun oynama" }, { ar: "Ø¹ÙÙ…ÙÙ„ÙŒ", base_ar:"Ø¹Ù…Ù„", tr: "Ã‡alÄ±ÅŸma" }, { ar: "ÙÙØ´ÙÙ„ÙŒ", base_ar:"ÙØ´Ù„", tr: "BaÅŸarÄ±sÄ±zlÄ±k" }, { ar: "ÙƒÙØ³ÙÙ„ÙŒ", base_ar:"ÙƒØ³Ù„", tr: "Tembellik" }, { ar: "Ø°ÙÙ‡ÙØ¨Ù", base_ar:"Ø°Ù‡Ø¨", tr: "AltÄ±n" }, { ar: "Ø³ÙÙ…ÙÙƒÙ", base_ar:"Ø³Ù…Ùƒ", tr: "BalÄ±k" }, { ar: "Ù‡ÙÙˆÙ", base_ar:"Ù‡Ùˆ", tr: "O - erkek" }, { ar: "Ù‡ÙÙŠÙ", base_ar:"Ù‡ÙŠ", tr: "O - kÄ±z" }, { ar: "Ù…ÙÙ†Ù’", base_ar:"Ù…Ù†", tr: "-den, -dan" } ] },
             2: { timePerLetter: 7, words: [ { ar: "Ù‡ÙÙˆÙ", base_ar:"Ù‡Ùˆ", tr: "O" }, { ar: "Ù‡ÙÙŠÙ", base_ar:"Ù‡ÙŠ", tr: "O" }, { ar: "Ø¹ÙÙ†Ù’", base_ar:"Ø¹Ù†", tr: "hakkÄ±nda" }, { ar: "Ù„ÙÙ…Ù’", base_ar:"Ù„Ù…", tr: "-medi, -madÄ±" }, { ar: "Ù†ÙØ¹ÙÙ…Ù’", base_ar:"Ù†Ø¹Ù…", tr: "Evet" }, { ar: "Ø¬ÙÙ„ÙØ³Ù", base_ar:"Ø¬Ù„Ø³", tr: "Oturdu" }, { ar: "ÙƒÙØªÙØ¨Ù", base_ar:"ÙƒØªØ¨", tr: "YazdÄ±" }, { ar: "Ø°ÙÙ‡ÙØ¨ÙŒ", base_ar:"Ø°Ù‡Ø¨", tr: "AltÄ±n" }, { ar: "Ø¨ÙØ­Ù’Ø±ÙŒ", base_ar:"Ø¨Ø­Ø±", tr: "Deniz" }, { ar: "Ù…ÙØ·Ù’Ø¨ÙØ®ÙŒ", base_ar:"Ù…Ø·Ø¨Ø®", tr: "Mutfak" }, { ar: "ÙŠÙÙƒÙ’ØªÙØ¨Ù", base_ar:"ÙŠÙƒØªØ¨", tr: "YazÄ±yor" }, { ar: "ÙŠÙØºÙ’Ø³ÙÙ„Ù", base_ar:"ÙŠØºØ³Ù„", tr: "YÄ±kÄ±yor" } ] },
             3: { timePerLetter: 6, words: [ { ar: "Ù„ÙØ§", base_ar:"Ù„", tr: "HayÄ±r" }, { ar: "Ø£ÙÙ†ÙØ§", base_ar:"Ø§Ù†Ø§", tr: "Ben" }, { ar: "Ø¨ÙØ§Ø¨ÙŒ", base_ar:"Ø¨Ø§Ø¨", tr: "KapÄ±" }, { ar: "Ù‡ÙÙ†ÙØ§", base_ar:"Ù‡Ù†", tr: "Burada" }, { ar: "Ø®ÙØ§Ø±ÙØ¬Ù‹Ø§", base_ar:"Ø®Ø±Ø¬", tr: "DÄ±ÅŸÄ±nda" }, { ar: "ÙŠÙØ´Ù’Ø±ÙØ¨Ù", base_ar:"ÙŠØ´Ø±Ø¨", tr: "Ä°Ã§iyor" }, { ar: "ÙŠÙØºÙ’Ø³ÙÙ„Ù", base_ar:"ÙŠØºØ³Ù„", tr: "YÄ±kÄ±yor" }, { ar: "ØºÙØ³ÙÙ„Ù", base_ar:"ØºØ³Ù„", tr: "YÄ±kadÄ±" }, { ar: "Ù†ÙØ¹ÙÙ…Ù’", base_ar:"Ù†Ø¹Ù…", tr: "Evet" }, { ar: "Ù‚ÙÙ„ÙÙ…Ù", base_ar:"Ù‚Ù„Ù…", tr: "Kalem" }, { ar: "Ø³ÙÙ…ÙÙƒÙŒ", base_ar:"Ø³Ù…Ùƒ", tr: "BalÄ±k" }, { ar: "Ø£ÙÙ†Ù’", base_ar:"Ø§Ù†", tr: "-mek, mak" }, { ar: "Ø¥ÙÙ†Ù’", base_ar:"Ø§Ù†", tr: "-se, -sa" } ] },
             4: { timePerLetter: 5, words: [ { ar: "ÙÙÙŠ", base_ar:"ÙÙŠ", tr: "iÃ§inde, -da, -da" }, { ar: "Ù…ÙØ¹Ù‹Ø§", base_ar:"Ù…Ø¹", tr: "Beraber" }, { ar: "Ø¹ÙÙ†Ù’Ø¯Ù", base_ar:"Ø¹Ù†Ø¯", tr: "var, yanÄ±nda" }, { ar: "ØµÙÙÙŒÙ‘", base_ar:"ØµÙ", tr: "SÄ±nÄ±f" }, { ar: "Ù…ÙØ®Ù’Ø±ÙØ¬ÙŒ", base_ar:"Ù…Ø®Ø±Ø¬", tr: "Ã‡Ä±kÄ±ÅŸ yeri" }, { ar: "ÙŠÙÙ†ÙØ§Ù…Ù", base_ar:"ÙŠÙ†Ù…", tr: "Uyuyor" }, { ar: "Ù‡ÙÙˆÙ", base_ar:"Ù‡Ùˆ", tr: "O" }, { ar: "ÙŠÙØ¬Ù’Ù„ÙØ³Ù", base_ar:"ÙŠØ¬Ù„Ø³", tr: "Oturuyor" }, { ar: "ÙŠÙÙ‚Ù’Ø±ÙØ£Ù", base_ar:"ÙŠÙ‚Ø±", tr: "Okuyor" }, { ar: "ÙŠÙÙ„Ù’Ø¹ÙØ¨Ù", base_ar:"ÙŠÙ„Ø¹Ø¨", tr: "Oynuyor" }, { ar: "ÙŠÙØ¯Ù’Ø±ÙØ³Ù", base_ar:"ÙŠØ¯Ø±Ø³", tr: "Ders Ã‡alÄ±ÅŸÄ±yor" }, { ar: "ÙŠÙÙÙ’ØªÙØ­Ù", base_ar:"ÙŠÙØªØ­", tr: "AÃ§Ä±yor" }, { ar: "ÙŠÙØ­Ù’Ù…ÙÙ„Ù", base_ar:"ÙŠØ­Ù…Ù„", tr: "TaÅŸÄ±yor" } ] },
             5: { timePerLetter: 4, words: [ { ar: "Ø§ÙØ³Ù’ØªÙÙ…ÙØ¹ÙŠ", base_ar:"Ø§Ø³ØªÙ…Ø¹", tr: "Dinle - kÄ±z" }, { ar: "ØªÙØ´ÙØ±ÙÙ‘ÙÙ’ØªÙ", base_ar:"ØªØ´Ø±ÙØª", tr: "TanÄ±ÅŸtÄ±ÄŸÄ±ma memnun oldum" }, { ar: "Ø¹ÙÙ„ÙÙŠÙ’ÙƒÙÙ…Ù’", base_ar:"Ø¹Ù„ÙŠÙƒÙ…", tr: "Ã¼zerinize olsun" }, { ar: "ÙˆÙØ³ÙÙ‡Ù’Ù„Ù‹Ø§", base_ar:"ÙˆØ³Ù‡Ù„", tr: "HoÅŸ geldiniz" }, { ar: "Ø§Ù„Ù’Ù€Ø­ÙÙ…Ù’Ø¯", base_ar:"Ø§Ù„Ø­Ù…Ø¯", tr: "Hamd" }, { ar: "Ø§ÙØ­Ù’ØªÙØ±ÙÙ…Ù’", base_ar:"Ø§Ø­ØªØ±Ù…", tr: "SaygÄ± duy!" }, { ar: "Ø§ÙƒÙ’ØªÙØ¨ÙÙŠ", base_ar:"Ø§ÙƒØªØ¨", tr: "Yaz - kÄ±z" }, { ar: "Ø£ÙØ¹ÙÙŠØ¯ÙŠ", base_ar:"Ø§Ø¹ÙŠØ¯", tr: "Tekrar et - kÄ±z" }, { ar: "ØªÙØ¹Ø§Ø±ÙÙ", base_ar:"ØªØ¹Ø±Ù", tr: "TanÄ±ÅŸma" }, { ar: "ØµÙØ¨ÙØ§Ø­", base_ar:"ØµØ¨Ø­", tr: "Sabah" }, { ar: "Ù…ÙØ³ÙØ§Ø¡Ù‹", base_ar:"Ù…Ø³", tr: "AkÅŸam" } ] },
             6: { timePerLetter: 4, words: [ { ar: "ÙŠÙØ³Ù’ØªÙÙŠÙ’Ù‚ÙØ¸Ù", base_ar:"ÙŠØ³ØªÙŠÙ‚Ø¸", tr: "UyanÄ±yor" }, { ar: "ÙŠÙØ³Ù’ØªÙØ±ÙÙŠØ­Ù", base_ar:"ÙŠØ³ØªØ±Ø­", tr: "Dinleniyor" }, { ar: "Ø§ÙØ¯Ù’Ø±ÙØ³ÙÙŠ", base_ar:"Ø§Ø¯Ø±Ø³", tr: "Ders Ã§alÄ±ÅŸ!" }, { ar: "Ø§ÙØªÙÙ‘ÙÙÙ‚Ù’Ù†ÙØ§", base_ar:"Ø§ØªÙÙ‚", tr: "AnlaÅŸtÄ±k!" }, { ar: "Ù…ÙØ±Ù’Ø­ÙØ¨Ù‹Ø§", base_ar:"Ù…Ø±Ø­Ø¨", tr: "Merhaba" }, { ar: "Ø³ÙÙ„ÙØ§Ù…Ù", base_ar:"Ø³Ù„Ù…", tr: "Esenlik" }, { ar: "Ø§ÙØ¨Ù’ØªÙØ¹ÙØ¯Ù’", base_ar:"Ø§Ø¨ØªØ¹Ø¯", tr: "UzaklaÅŸ!" }, { ar: "Ø§ÙØ±Ù’Ø³ÙÙ…ÙÙŠ", base_ar:"Ø§Ø±Ø³Ù…", tr: "Resim yap!" }, { ar: "ØªÙØ­ÙÙŠÙÙ‘Ø©", base_ar:"ØªØ­ÙŠØ©", tr: "SelamlaÅŸma" }, { ar: "ÙŠÙÙ‚ÙÙˆÙ…Ù", base_ar:"ÙŠÙ‚ÙˆÙ…", tr: "KalkÄ±yor" }, { ar: "Ø¯ÙÙÙ’ØªÙØ±Ù", base_ar:"Ø¯ÙØªØ±", tr: "Defter" }, { ar: "Ø·ÙØ¨Ù’Ø¹Ù‹Ø§", base_ar:"Ø·Ø¨Ø¹", tr: "Peki, tabii!" }, { ar: "Ù…ÙÙƒÙ’ØªÙØ¨ÙŒ", base_ar:"Ù…ÙƒØªØ¨", tr: "Masa" } ] },
             7: { timePerLetter: 3, words: [ { ar: "ÙŠÙØªÙØ­ÙØ¯ÙÙ‘Ø«ÙÙˆÙ†", base_ar:"ÙŠØªØ­Ø¯Ø«", tr: "KonuÅŸuyorlar" }, { ar: "ÙŠÙØªÙØ¹ÙØ§ÙˆÙÙ†ÙÙˆÙ†", base_ar:"ÙŠØªØ¹Ø§ÙˆÙ†", tr: "YardÄ±mlaÅŸÄ±yorlar" }, { ar: "ÙŠÙØ±Ù’Ø¬ÙØ¹ÙÙˆÙ†", base_ar:"ÙŠØ±Ø¬Ø¹", tr: "DÃ¶nÃ¼yorlar" }, { ar: "Ù…ÙØ´Ù’Ø±ÙÙˆØ¨ÙØ§Øª", base_ar:"Ù…Ø´Ø±ÙˆØ¨", tr: "Ä°Ã§ecekler" }, { ar: "ØªÙÙƒÙÙ„ÙÙ‘Ù…Ù’ØªÙ", base_ar:"ØªÙƒÙ„Ù…", tr: "KonuÅŸtum" }, { ar: "Ø§ÙØ³Ù’ØªÙÙ…ÙØ¹ÙÙŠ", base_ar:"Ø§Ø³ØªÙ…Ø¹", tr: "Dinle" }, { ar: "Ù„ÙÙŠÙ’Ù„ÙØ©", base_ar:"Ù„ÙŠÙ„", tr: "Gece" }, { ar: "Ø¸ÙÙ‡Ù’Ø±ÙŒ", base_ar:"Ø¸Ù‡Ø±", tr: "Ã–ÄŸle" }, { ar: "ÙˆÙØ¬Ù’Ù‡ÙŒ", base_ar:"ÙˆØ¬Ù‡", tr: "YÃ¼z" }, { ar: "Ø£ÙÙ†ÙØ¸ÙÙ‘ÙÙ", base_ar:"Ø§Ù†Ø¸Ù", tr: "Temizliyorum" }, { ar: "Ø£ÙØ±ÙØ§Ø¬ÙØ¹Ù", base_ar:"Ø§Ø±Ø§Ø¬Ø¹", tr: "Tekrar ediyorum" }, { ar: "Ø§ÙÙ„Ù’ÙˆÙØ¯ÙØ§Ø¹", base_ar:"Ø§Ù„ÙˆØ¯Ø§Ø¹", tr: "VedalaÅŸmak" }, { ar: "Ø·ÙØ§Ù„ÙØ¨ÙŒ", base_ar:"Ø·Ø§Ù„Ø¨", tr: "Erkek Ã¶ÄŸrenci" }, { ar: "ÙƒÙØªÙØ§Ø¨ÙŒ", base_ar:"ÙƒØªØ¨", tr: "Kitap" } ] },
             8: { timePerLetter: 3, words: [ { ar: "Ù…ÙØ¹ÙÙ„ÙÙ‘Ù…ÙØ§Øª", base_ar:"Ù…Ø¹Ù„Ù…", tr: "Ã–ÄŸretmenler" }, { ar: "Ù…ÙØ£Ù’ÙƒÙÙˆÙ„ÙØ§Øª", base_ar:"Ù…Ø§ÙƒÙˆÙ„", tr: "Yiyecekler" }, { ar: "ÙŠÙÙ„Ù’Ø¹ÙØ¨ÙÙˆÙ†", base_ar:"ÙŠÙ„Ø¹Ø¨", tr: "Oynuyorlar" }, { ar: "ØªÙÙ„Ù’ÙÙØ§Ø²ÙŒ", base_ar:"ØªÙ„ÙØ²", tr: "Televizyon" }, { ar: "Ù…ÙÙ„ÙØ§Ø¨ÙØ³Ù", base_ar:"Ù…Ù„Ø¨Ø³", tr: "Elbiseler" }, { ar: "Ù†ÙØ¸ÙØ§Ù…ÙŒ", base_ar:"Ù†Ø¸Ù…", tr: "DÃ¼zen" }, { ar: "Ù…ÙØ¨ÙÙƒÙÙ‘Ø±Ù‹Ø§", base_ar:"Ù…Ø¨ÙƒØ±", tr: "Erken" }, { ar: "Ø§ÙØ³Ù’ØªÙØ±ÙØ§Ø­ÙØ©", base_ar:"Ø§Ø³ØªØ±Ø­", tr: "Dinlenmek" }, { ar: "Ø£ÙØªÙÙ†ÙØ§ÙˆÙÙ„Ù", base_ar:"Ø§ØªÙ†Ø§ÙˆÙ„", tr: "Yiyorum" }, { ar: "ØªÙØ¹ÙÙ„ÙÙ‘Ù…Ù’ØªÙ", base_ar:"ØªØ¹Ù„Ù…", tr: "Ã–ÄŸrendim" }, { ar: "Ù…ÙØ¯ÙØ±ÙÙ‘Ø³ÙØ©", base_ar:"Ù…Ø¯Ø±Ø³", tr: "Ã–ÄŸretmen" }, { ar: "ÙŠÙØµÙÙ„ÙÙ‘ÙŠ", base_ar:"ÙŠØµÙ„", tr: "Namaz kÄ±lÄ±yor" }, { ar: "ÙŠÙÙ†ÙØ¸ÙÙ‘ÙÙ", base_ar:"ÙŠÙ†Ø¸Ù", tr: "Temizliyor" }, { ar: "Ø¬ÙÙ…ÙÙŠÙ„ÙŒ", base_ar:"Ø¬Ù…ÙŠÙ„", tr: "GÃ¼zel" }, { ar: "Ø·ÙØ§ÙˆÙÙ„ÙØ©", base_ar:"Ø·Ø§ÙˆÙ„", tr: "Masa" }, { ar: "ÙŠÙØ®Ù’Ø±ÙØ¬Ù", base_ar:"ÙŠØ®Ø±Ø¬", tr: "Ã‡Ä±kÄ±yor" } ] }
        };

        const homeScreen = document.getElementById('homeScreen');
        const gameScreen = document.getElementById('gameScreen');
        const scoreScreen = document.getElementById('scoreScreen');
        const levelSelect = document.getElementById('levelSelect');
        const backToHomeButton = document.getElementById('backToHomeButton');
        const scoreToHomeButton = document.getElementById('scoreToHomeButton');
        const timerDisplay = document.getElementById('timerDisplay');
        const gameHeader = document.getElementById('gameHeader');
        const gameMain = document.getElementById('gameMain');
        const gameFooter = document.getElementById('gameFooter');
        const levelScoreDisplay = document.getElementById('levelScoreDisplay');
        const pointsBurst = document.getElementById('pointsBurst');
        const mistakeCounter = document.getElementById('mistakeCounter');
        const playAudioButton = document.getElementById('playAudioButton');
        const nextButton = document.getElementById('nextButton');
        const turkishWordEl = document.getElementById('turkishWord');
        const arabicOutputEl = document.getElementById('arabicOutputDisplay');
        const arabicOutputContainer = document.getElementById('arabicOutputContainer');
        const letterBankContainer = document.getElementById('letterBankContainer');
        const letterBank = document.getElementById('letterBank');
        const audioControl = document.getElementById('audioControl');
        const scoreTitle = document.getElementById('scoreTitle');
        const singlePlayerScoreText = document.getElementById('singlePlayerScoreText');
        const finalScoreValueEl = document.getElementById('finalScoreValue');
        const totalPossibleScoreEl = document.getElementById('totalPossibleScore');
        const incorrectListEl = document.getElementById('incorrectList');
        const incorrectWordsUlEl = document.getElementById('incorrectWordsUl');

        let selectedLevel = null;
        let currentWordIndex = 0;
        let levelWords = [], currentWord = {}, timerInterval, remainingTime = 0;
        let selectedLevelBtn = null;
        let gameActive = false;
        let wordActive = false;
        let autoNextTimeout;
        let audio = new Audio(); // Kelime sesleri iÃ§in
        let waitingForAudioClick = false;
        let selection = [];
        let expectedFullCharIndex = 0;
        let mistakesMade = 0;
        let mistakesAllowed = 3;
        let currentLevelScore = 0;
        let incorrectWords = [];
        let basePointsPerWord = 0;
        let pointsRemainder = 0;
        const shadda = 'Ù‘';
        const shortVowels = ['Ù', 'Ù', 'Ù', 'Ù‹', 'Ù', 'ÙŒ', 'Ù’'];
        let fullWordChars = [];

        // Kelime ses dosyasÄ± yollarÄ±nÄ± oluÅŸtur
        Object.keys(gameData).forEach(level => {
            const levelData = gameData[level];
            if (levelData.words && Array.isArray(levelData.words)) {
                levelData.words.forEach((word, index) => {
                    const voiceNumber = index + 1;
                    word.audioSrc = `l${level}v${voiceNumber}.wav`;
                });
            }
        });
        console.log("Game data updated with word audio sources:", gameData);

        // Kelime sesini Ã§almak iÃ§in fonksiyon (HTML Audio elementi ile)
         function playAudio() {
             console.log("playAudio called for word. Word object:", currentWord);
             if (!currentWord || !currentWord.audioSrc) { console.warn("No currentWord or audioSrc set for word audio."); return; }
             if (!audio.paused) { audio.pause(); audio.currentTime = 0; }
             audio.src = currentWord.audioSrc;
             console.log("Attempting to play word audio:", audio.src);
             const playPromise = audio.play();
             if (playPromise !== undefined) {
                 playPromise.catch(e => console.error("Word audio playback error:", e))
                          .then(() => console.log("Word playback started for:", audio.src));
             }
         }

        function triggerPointsBurst(points) {
            if (!pointsBurst) return;
            pointsBurst.textContent = `+${points} Puan!`;
            pointsBurst.classList.add('active');
            setTimeout(() => pointsBurst.classList.remove('active'), 800);
        }

        // Hata kaydetme ve yanlÄ±ÅŸ sesini Ã§alma
        function registerMistake(buttonRef) {
             if (!wordActive || mistakesMade >= mistakesAllowed) return;
             playSound('incorrect'); // YanlÄ±ÅŸ sesini Ã§al
             mistakesMade++;
             updateMistakeDisplay();
             if (buttonRef) {
                  buttonRef.classList.add('error-form');
                  setTimeout(() => buttonRef.classList.remove('error-form'), 300);
             }
             if (mistakesMade >= mistakesAllowed) {
                  console.log("Hata hakkÄ± bitti!");
                  checkAnswer(true); // Hata hakkÄ± dolduÄŸunda kontrol et
             }
        }

         function updateMistakeDisplay() {
             let hearts = '';
             for (let i = 0; i < mistakesAllowed - mistakesMade; i++) { hearts += 'â¤ï¸ '; }
             for (let i = 0; i < mistakesMade; i++) { hearts += 'ğŸ–¤ '; }
             mistakeCounter.textContent = hearts.trim() || 'ğŸ–¤';
         }

        // Seviye seÃ§ildiÄŸinde Web Audio baÄŸlamÄ±nÄ± baÅŸlat
        levelSelect.addEventListener('click', (e) => {
            if (e.target.classList.contains('level-btn')) {
                initAudioContext(); // Ses baÄŸlamÄ±nÄ± baÅŸlat/kontrol et
                if (selectedLevelBtn) { selectedLevelBtn.classList.remove('selected'); }
                selectedLevel = e.target.dataset.level;
                selectedLevelBtn = e.target;
                selectedLevelBtn.classList.add('selected');
                console.log("Level selected:", selectedLevel);
                startGame();
            }
        });

        function startGame() {
            const gameMode = 'single';
            console.log(`Starting game - Level: ${selectedLevel}, Mode: ${gameMode}`);
            clearTimeout(autoNextTimeout);
            if (!gameData[selectedLevel] || !gameData[selectedLevel].words) {
                console.error(`Oyun verisi bulunamadÄ±! Seviye: ${selectedLevel}`);
                if (selectedLevelBtn) { selectedLevelBtn.classList.remove('selected'); }
                return;
            }
            levelWords = [...gameData[selectedLevel].words].sort(() => Math.random() - 0.5);
            currentWordIndex = 0;
            currentLevelScore = 0; incorrectWords = [];
            const numWords = levelWords.length;
            basePointsPerWord = Math.floor(100 / numWords);
            pointsRemainder = 100 % numWords;
            levelScoreDisplay.textContent = `Puan: 0`;
            mistakeCounter.style.display = 'block';
            homeScreen.classList.remove('active');
            scoreScreen.classList.remove('active');
            gameScreen.classList.add('active');
            history.pushState({ screen: 'game', mode: gameMode, level: selectedLevel }, '', '#game');
            loadWord();
        }

        function loadWord() {
            clearTimeout(autoNextTimeout); wordActive = false;
            playAudioButton.classList.remove('hidden'); // Ses butonunu gÃ¶ster
            nextButton.classList.add('hidden'); // Ä°lerle butonunu gizle

            if (currentWordIndex >= levelWords.length) { showScoreScreen(); return; }
            currentWord = levelWords[currentWordIndex];
            
            // --- GÃœNCELLENDÄ°: Yeni spesifik satÄ±r atlama mantÄ±ÄŸÄ± ---
            const wordLength = Array.from(currentWord.ar).length;
            letterBankContainer.classList.remove('rows-2', 'rows-3', 'rows-4', 'rows-5', 'rows-11');

            if (wordLength >= 5 && wordLength <= 8) {
                letterBankContainer.classList.add('rows-2'); // 5-8 harf (2 satÄ±r)
            } else if ((wordLength >= 9 && wordLength <= 10) || (wordLength >= 12 && wordLength <= 14)) {
                letterBankContainer.classList.add('rows-3'); // 9-10, 12-14 harf (3 satÄ±r)
            } else if (wordLength === 11) {
                letterBankContainer.classList.add('rows-11'); // 11 harf (3 satÄ±r -> 4-4-3)
            } else if (wordLength === 15) {
                letterBankContainer.classList.add('rows-5'); // 15 harf (5 satÄ±r)
            } else if (wordLength >= 16) {
                letterBankContainer.classList.add('rows-4'); // 16+ harf (4 satÄ±r)
            }
            // 4 veya daha az harf iÃ§in sÄ±nÄ±f eklenmez (varsayÄ±lan 1 satÄ±r)
            // --- ---

            originalWord = currentWord.ar;
            fullWordChars = Array.from(originalWord).map((char, index) => ({ char: char, id: `${char}-${index}` }));
            const letterCount = fullWordChars.length;
            remainingTime = letterCount * gameData[selectedLevel].timePerLetter;
            timerDisplay.textContent = `â±ï¸${remainingTime}s`;
            clearInterval(timerInterval);
            turkishWordEl.textContent = currentWord.tr;
            selection = []; expectedFullCharIndex = 0; mistakesMade = 0;
            arabicOutputEl.textContent = ''; arabicOutputEl.classList.add('empty');
            arabicOutputContainer.style.boxShadow = 'inset 3px 3px 6px var(--color-shadow-dark), inset -3px -3px 6px var(--color-shadow-light)';
            populateLetterBank(); disableLetterBank(true); updateMistakeDisplay();
            playAudioButton.disabled = false; playAudioButton.classList.add('blinking-button');
            waitingForAudioClick = true;
        }

        function populateLetterBank() {
            letterBank.innerHTML = '';
            const allChars = Array.from(originalWord);
            const buttonsData = allChars.map((char, index) => ({ char: char, id: `${char}-${index}` }));
            buttonsData.sort(() => Math.random() - 0.5);
            const buttonElements = buttonsData.map(data => {
                const btn = document.createElement('button'); btn.className = 'letter-bank-btn key-button';
                btn.textContent = data.char; btn.dataset.value = data.char; btn.dataset.id = data.id;
                // YENÄ°: Butonlara lang="ar" ekle
                btn.setAttribute('lang', 'ar');
                const harekeler = ['Ù','Ù‹','Ù','Ù','Ù','ÙŒ','Ù‘','Ù’'];
                if(harekeler.includes(data.char)){ btn.classList.add('hareke-char'); }
                else { btn.classList.add('char-only'); }
                return btn;
            });
            buttonElements.forEach(btn => letterBank.appendChild(btn));
        }

        function appendCharToOutput(char) { arabicOutputEl.classList.remove('empty'); arabicOutputEl.textContent += char; }
        function disableLetterBank(disabled) {
            letterBank.querySelectorAll('.letter-bank-btn').forEach(btn => {
                if (btn.classList.contains('correct-form')) { btn.disabled = true; btn.style.opacity = '0.75'; }
                else { btn.disabled = disabled; btn.style.opacity = btn.disabled ? '0.65' : '1'; }
            });
        }
        function disableAllButtons(disabled) {
             disableLetterBank(disabled);
             playAudioButton.disabled = disabled;
        }

        function startTimer() {
            clearInterval(timerInterval); gameActive = true;
            timerInterval = setInterval(() => {
                if (!gameActive) { clearInterval(timerInterval); return; }
                remainingTime--; timerDisplay.textContent = `â±ï¸${remainingTime}s`;
                if (remainingTime <= 0) {
                    clearInterval(timerInterval); timerDisplay.textContent = 'â±ï¸0s';
                    gameActive = false; wordActive = false;
                    checkAnswer(true); // Zaman bitti
                }
            }, 1000);
        }

        function checkAnswer(timeUp = false) {
             if (!wordActive && !waitingForAudioClick && !timeUp) return;
             wordActive = false; waitingForAudioClick = false;
             playAudioButton.classList.remove('blinking-button');
             clearTimeout(autoNextTimeout); clearInterval(timerInterval);
             gameActive = false; disableAllButtons(true);

             const constructedWord = arabicOutputEl.textContent;
             if(constructedWord === "") arabicOutputEl.classList.add('empty');
             else arabicOutputEl.classList.remove('empty');
             const targetWordForCheck = fullWordChars.map(item => item.char).join('');
             const isCorrect = constructedWord.trim() === targetWordForCheck.trim() && !timeUp && mistakesMade < mistakesAllowed;

             if (isCorrect) {
                 let pointsAwarded = basePointsPerWord; if (currentWordIndex < pointsRemainder) { pointsAwarded++; }
                 currentLevelScore += pointsAwarded; levelScoreDisplay.textContent = `Puan: ${currentLevelScore}`; triggerPointsBurst(pointsAwarded);
                 arabicOutputContainer.style.boxShadow = 'inset 3px 3px 6px #76b198, inset -3px -3px 6px #baffa0';
                 autoNextTimeout = setTimeout(nextWord, 1000); // DoÄŸruysa 1sn sonra otomatik geÃ§
             } else {
                 if (timeUp || mistakesMade >= mistakesAllowed) { playSound('incorrect'); }
                 arabicOutputContainer.style.boxShadow = 'inset 3px 3px 6px #d35f61, inset -3px -3px 6px #ff8386';
                 if (!incorrectWords.some(word => word.ar === currentWord.ar)) {
                     incorrectWords.push({ ar: currentWord.ar, tr: currentWord.tr });
                 }
                 playAudioButton.classList.add('hidden'); // Ses butonunu gizle
                 nextButton.classList.remove('hidden'); // Ä°lerle butonunu gÃ¶ster
             }
        }

        function nextWord() {
            currentWordIndex++;
            loadWord(); // Yeni kelime yÃ¼kle (loadWord butonlarÄ± sÄ±fÄ±rlar)
        }

        function showScoreScreen() {
            gameActive = false; waitingForAudioClick = false;
            clearTimeout(autoNextTimeout); clearInterval(timerInterval);
            gameScreen.classList.remove('active');
            scoreScreen.classList.add('active');
            finalScoreValueEl.textContent = currentLevelScore; totalPossibleScoreEl.textContent = "100";
            incorrectWordsUlEl.innerHTML = '';
            if (incorrectWords.length > 0) {
                incorrectListEl.style.display = 'block';
                incorrectWords.forEach(word => {
                    const li = document.createElement('li');
                    const spanTr = document.createElement('span'); spanTr.textContent = word.tr || '';
                    const spanAr = document.createElement('span'); spanAr.textContent = word.ar || '';
                    // YENÄ°: YanlÄ±ÅŸ listesine de lang="ar" ekle
                    spanAr.setAttribute('dir', 'rtl'); spanAr.setAttribute('lang', 'ar');
                    li.appendChild(spanTr); li.appendChild(spanAr);
                    incorrectWordsUlEl.appendChild(li);
                });
            } else { incorrectListEl.style.display = 'none'; }
        }

        function showHomeScreen() {
            clearTimeout(autoNextTimeout); gameActive = false; wordActive = false; waitingForAudioClick = false; clearInterval(timerInterval);
            gameScreen.classList.remove('active');
            scoreScreen.classList.remove('active');
            homeScreen.classList.add('active');
            history.replaceState({ screen: 'home' }, '', window.location.pathname);
             if (selectedLevelBtn) { selectedLevelBtn.classList.remove('selected'); selectedLevelBtn = null; } selectedLevel = null;
        }

        // Olay Dinleyicileri
        backToHomeButton.addEventListener('click', showHomeScreen);
        scoreToHomeButton.addEventListener('click', showHomeScreen);
        nextButton.addEventListener('click', nextWord);

        playAudioButton.addEventListener('click', () => {
             initAudioContext();
            if (waitingForAudioClick) {
                waitingForAudioClick = false; wordActive = true;
                playAudioButton.classList.remove('blinking-button');
                playAudio(); startTimer(); disableLetterBank(false);
            } else if (wordActive || gameActive) { playAudio();
            } else if (!gameActive && currentWord && currentWord.audioSrc) { playAudio(); }
        });

        letterBank.addEventListener('click', (e) => {
            if (!wordActive) return; initAudioContext();
            const clickedButton = e.target.closest('.letter-bank-btn:not(:disabled)');
            if (!clickedButton) return;

            playSound('touch'); // Dokunma sesini Ã§al

            const clickedChar = clickedButton.dataset.value; const clickedId = clickedButton.dataset.id;
             if (expectedFullCharIndex >= fullWordChars.length) { registerMistake(clickedButton); return; }
             const expectedObj = fullWordChars[expectedFullCharIndex];
             if (clickedChar === expectedObj.char) {
                 // playSound('correct'); // KALDIRILDI
                 appendCharToOutput(clickedChar); clickedButton.disabled = true; clickedButton.classList.add('correct-form');
                 expectedFullCharIndex++;
                 if (expectedFullCharIndex === fullWordChars.length) { checkAnswer(false); }
             } else { registerMistake(clickedButton); }
         });

        window.addEventListener('popstate', (event) => {
             if (gameScreen.classList.contains('active') || scoreScreen.classList.contains('active')) { showHomeScreen(); }
         });

        function initializeApp() {
            document.querySelectorAll('.screen').forEach(screen => { screen.classList.remove('active'); });
            homeScreen.classList.add('active');
            history.replaceState({ screen: 'home' }, '', window.location.pathname);
             selectedLevel = null;
             const modeContainer = document.getElementById('modeSelectContainer');
             if (modeContainer) modeContainer.style.display = 'none';
        }

        initializeApp();
    </script>
</body>
</html>