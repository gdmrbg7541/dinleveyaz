<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dinle ve Yaz | ÿßŸêÿ≥Ÿíÿ™ŸéŸÖŸêÿπŸí ŸàŸéÿßŸÉŸíÿ™Ÿèÿ®Ÿí</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Harmattan:wght@400;700&family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">

    <style>
        :root {
            --font-poppins: 'Poppins', sans-serif;
            --font-harmattan: 'Harmattan', Arial, sans-serif;
            --color-bg: #eef2f7;
            --color-surface: #ffffff;
            --color-shadow-light: #ffffff;
            --color-shadow-dark: #d1d9e6;
            --color-text-primary: #4a5a6a;
            --color-text-secondary: #8d9aad;
            --color-accent-1: #6a9fcf;
            --color-accent-2: #8ab6e2;
            --color-selected-bg: #6a9fcf;
            --color-selected-text: #ffffff;
            --color-correct: #6cbd9c;
            --color-error: #e68e8e;
            --color-correct-light: #e1f2ec;
            --color-error-light: #fbe9e9;
            --color-score: #f5a65b;
            --border-radius-main: 1.2rem;
            --border-radius-small: 0.8rem;
        }

        html { font-size: 16px; }
        body {
            font-family: var(--font-poppins); background: var(--color-bg); color: var(--color-text-primary); margin: 0; padding: 1rem;
            display: flex; justify-content: center; align-items: center; min-height: 100vh;
            overflow: hidden; /* Dikey kaydƒ±rmayƒ± engelle */
        }

        .screen {
            width: 100%; max-width: 50rem; margin: auto;
            background-color: transparent;
            border-radius: 0;
            box-shadow: none;
            border: none;
            padding: 1rem; box-sizing: border-box;
            display: none;
            flex-direction: column; align-items: center;
            justify-content: flex-start;
            height: calc(100vh - 2rem);
            max-height: 800px;
        }
        .screen.active {
            display: flex;
        }

        #gameScreen, #scoreScreen {
             flex-grow: 1;
             flex-direction: column;
             min-height: 0;
             width: 100%;
             justify-content: space-between;
             overflow: hidden;
        }

        #homeScreen { text-align: center; justify-content: center;}
        .title-container { display: flex; flex-direction: column; justify-content: center; align-items: center; gap: 0.5rem; margin-bottom: 2rem; flex-shrink: 0;}
        .title-text h1 { font-size: clamp(3rem, 10vw, 4.5rem); color: var(--color-accent-1); margin: 0; font-family: var(--font-poppins); text-shadow: 1px 1px 2px var(--color-shadow-dark); }
        .title-text h2 { font-size: clamp(2.5rem, 8vw, 3.5rem); font-weight: 700; color: var(--color-accent-2); margin: 0; text-shadow: 1px 1px 1px var(--color-shadow-dark); font-family: var(--font-harmattan); }
        #homeScreen h3 { font-size: 2.2rem; font-family: var(--font-poppins); color: var(--color-text-secondary); padding-bottom: 0.5rem; margin-top: 1rem; font-weight: 600; border-bottom: 2px solid var(--color-shadow-dark); margin-bottom: 1.5rem; flex-shrink: 0; width: auto; display: inline-block;}
        #levelSelect { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 1rem; width: 100%; max-width: 45rem; margin: 0 auto 1rem; flex-shrink: 0;}

        .key-button {
            padding: 0.8rem 1rem; font-size: 1rem; font-weight: 600; font-family: inherit;
            border: none;
            border-radius: var(--border-radius-small); cursor: pointer;
            transition: all 0.2s ease-out;
            color: var(--color-text-primary);
            background: var(--color-bg);
            box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light);
            display: inline-flex; justify-content: center; align-items: center;
            line-height: 1.2; vertical-align: middle; user-select: none; -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none;
        }
        .key-button:active:not(:disabled) {
            box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light);
            transform: scale(0.98);
        }
        .key-button:hover:not(:disabled) {
             color: var(--color-accent-1);
        }

        .level-btn { font-size: 1.8rem; padding: 1.2rem 1.8rem; font-weight: 700;}
        .level-btn.selected {
             background: var(--color-selected-bg);
             color: var(--color-selected-text);
             box-shadow: inset 3px 3px 6px #5a86b3, inset -3px -3px 6px #7ac2eb;
             transform: none;
        }

        .action-btn { font-size: 1.3rem; border-radius: var(--border-radius-small); padding: 0.8rem 1.5rem; }
        .back-button { font-size: 2.5rem; width: 4.5rem; height: 4rem; padding: 0; }
        #scoreToHomeButton { font-size: 1.5rem; width: auto; min-width: 5rem; height: 4rem; padding: 0 1.5rem; margin: 1.5rem auto 0; display: block; }

        #gameHeader {
            position: relative; display: flex; justify-content: space-between; align-items: center; padding-bottom: 0.5rem;
            border-bottom: none; margin-bottom: 0.5rem; flex-shrink: 0; padding-left: 0; padding-right: 0; width: 100%;
             max-width: 45rem; margin-left: auto; margin-right: auto;
        }
        .header-info { font-size: 1.8rem; font-weight: 600; font-family: var(--font-poppins); background: var(--color-bg); padding: 0.5rem 1rem; border-radius: var(--border-radius-small); box-shadow: 2px 2px 4px var(--color-shadow-dark), -2px -2px 4px var(--color-shadow-light);}
        #levelScoreDisplay { color: var(--color-score); margin-right: auto; margin-left: 0; }
        #timerDisplay { color: var(--color-error); margin-left: auto; margin-right: 0; font-size: 2rem;}
        #mistakeCounter { color: var(--color-error); font-size: 2.2rem; letter-spacing: 2px; margin-left: 0.5rem; margin-right: 0.5rem; background: none; box-shadow: none; padding: 0;}

        /* --- G√úNCELLEME: Main alanƒ± dikey ortalama ve bo≈üluk --- */
        .game-main {
            text-align: center;
            flex-grow: 1;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; /* Dikeyde ortala */
            min-height: 0;
            gap: 0.5rem; /* Bo≈üluk azaltƒ±ldƒ± */
            padding: 0;
            width: 100%;
            overflow: hidden;
        }
        #gameContent {
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 0.5rem; /* Bo≈üluk azaltƒ±ldƒ± */
            width: 100%;
            max-width: 40rem;
            margin: auto;
        }

        #turkishWord, #arabicOutputContainer {
            padding: 0.5rem 1rem; min-height: auto; display: flex; align-items: center; position: relative;
            background: var(--color-bg);
            border: none;
            border-radius: var(--border-radius-main);
            box-shadow: inset 3px 3px 6px var(--color-shadow-dark), inset -3px -3px 6px var(--color-shadow-light);
            width: 100%; text-align: center; justify-content: center; flex-basis: auto; box-sizing: border-box; flex-shrink: 0; line-height: 1.3;
            overflow: hidden;
            word-break: break-all;
        }

        /* --- G√úNCELLEME: T√ºrk√ße kelime boyutu (Esnek clamp) --- */
        #turkishWord {
            order: 3;
            font-size: clamp(2.5rem, 8vmin, 4rem); /* Daha k√º√ß√ºk min/max */
            margin-top: 0;
            margin-bottom: 0;
            font-family: var(--font-poppins);
            font-weight: 600;
            color: var(--color-text-primary);
        }

        #arabicOutputContainer { order: 1; gap: 0.5rem; direction: rtl; background: var(--color-bg); margin-bottom: 0; }

        /* --- G√úNCELLEME: Arap√ßa yazƒ± boyutu (Esnek clamp) --- */
        #arabicOutputDisplay {
            width: auto; max-width: 100%; white-space: normal;
            font-family: var(--font-harmattan); font-weight: 700; line-height: 1.3; border: none;
            background: none; padding: 0; box-shadow: none; direction: rtl; cursor: default;
            font-size: clamp(2.5rem, 8vmin, 4rem); /* T√ºrk√ße ile aynƒ± clamp */
            transition: none; color: var(--color-text-primary);
        }

        #arabicOutputDisplay.empty::before { content: '...'; color: var(--color-text-secondary); font-weight: normal; font-size: 2rem; opacity: 0.8; width: 100%; text-align: center;}
        #correctAnswerContainer, #correctAnswerDisplay, #helperGrid, .char-btn, .separator, .tool-btn-danger, #checkButton, #nextButton { display: none !important; }

        #letterBankContainer {
            order: 2;
            overflow: hidden;
            padding: 0;
            margin: 0.5rem 0;
            transition: none;
            flex-grow: 1; /* Mevcut alanƒ± doldursun */
            flex-shrink: 1;
            width: 100%;
            box-sizing: border-box;
            max-width: 100%;
            display: flex;
            align-items: center; /* ƒ∞√ßeriƒüi dikeyde ortala */
            justify-content: center;
            min-height: 100px;
        }
        #letterBank {
            display: flex;
            flex-direction: row;
            flex-wrap: wrap;
            gap: clamp(0.2rem, 1vmin, 0.4rem);
            align-items: center;
            justify-content: center;
            padding: 0;
            max-width: 100%;
            margin: 0 auto;
        }
        /* .letter-bank-row artƒ±k kullanƒ±lmƒ±yor */


        /* --- G√úNCELLEME: Butonlar (Esnek clamp) --- */
        .letter-bank-btn {
            font-family: var(--font-harmattan); font-weight: 700;
            font-size: clamp(2.5rem, 8vmin, 4rem);  /* Metinlerle benzer clamp */
            width: clamp(3.5rem, 11vmin, 5.5rem);   /* Font boyutuna uygun */
            height: clamp(3.5rem, 11vmin, 5.5rem);  /* Font boyutuna uygun */
            padding: 0.3rem 0; /* Dikey padding azaltƒ±ldƒ± */
            margin: clamp(0.1rem, 0.5vmin, 0.2rem);
            background: var(--color-bg);
            color: var(--color-text-primary);
            border: none;
            box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light);
            border-radius: clamp(0.5rem, 2vmin, 1rem);
            transition: all 0.1s ease-out;
            display: inline-flex; justify-content: center; align-items: center;
            line-height: 1;
            vertical-align: middle; user-select: none;
            -webkit-user-select: none; -moz-user-select: none; -ms-user-select: none; cursor: pointer;
            flex-shrink: 0;
            box-sizing: border-box;
        }
        .letter-bank-btn:active:not(:disabled) {
            box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light);
            transform: scale(0.97);
        }

        .letter-bank-btn.hareke-char { font-size: clamp(1.8rem, 6vmin, 3rem); } /* Orantƒ±lƒ± */
        .letter-bank-btn.hareke-fatha { align-items: flex-start; padding-top: clamp(0.3rem, 1.2vmin, 0.6rem); } /* Orantƒ±lƒ± */
        .letter-bank-btn.hareke-kasra { align-items: flex-end; padding-bottom: clamp(0.3rem, 1.2vmin, 0.6rem); } /* Orantƒ±lƒ± */
        .letter-bank-btn.hareke-normal, .letter-bank-btn.char-only { align-items: center; padding-top: 0.3rem; padding-bottom: 0.3rem;} /* Normal padding */
        .letter-bank-btn.correct-form { background-color: var(--color-correct-light) !important; color: var(--color-correct) !important; box-shadow: inset 2px 2px 4px #5cb58f, inset -2px -2px 4px #8cf9c1 !important; cursor: default; transform: none !important; }
        .letter-bank-btn.error-form { background-color: var(--color-error-light) !important; color: var(--color-error) !important; box-shadow: inset 2px 2px 4px #cc7a7a, inset -2px -2px 4px #ffa0a0 !important; animation: shake 0.3s ease-in-out; transform: none !important; }
        @keyframes shake { 10%, 90% { transform: translate3d(-1px, 0, 0); } 20%, 80% { transform: translate3d(2px, 0, 0); } 30%, 50%, 70% { transform: translate3d(-4px, 0, 0); } 40%, 60% { transform: translate3d(4px, 0, 0); } }

        #audioControl { display: flex; }
        #audioControl button { font-size: 2.5rem; width: 4.5rem; height: 4rem; padding: 0; color: var(--color-selected-text);
            background: var(--color-accent-1);
            border: none;
            border-radius: var(--border-radius-small);
             box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light);
             transition: all 0.2s ease-out;
        }
        #audioControl button:hover:not(:disabled) { background: var(--color-accent-2); color: var(--color-selected-text); }
        #audioControl button:active:not(:disabled) {
             box-shadow: inset 2px 2px 4px #5a86b3, inset -2px -2px 4px #7ac2eb;
             transform: scale(0.98);
        }

        @keyframes blink { 0% { opacity: 1; transform: scale(1); box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light), 0 0 10px var(--color-accent-2); } 50% { opacity: 0.8; transform: scale(1.03); box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light), 0 0 20px 5px var(--color-accent-1); } 100% { opacity: 1; transform: scale(1); box-shadow: 4px 4px 8px var(--color-shadow-dark), -4px -4px 8px var(--color-shadow-light), 0 0 10px var(--color-accent-2); } }
        .blinking-button { animation: blink 1.2s infinite ease-in-out; }
        .highlight-active { }
        :disabled {
            background: var(--color-bg) !important;
            color: var(--color-text-secondary) !important;
             box-shadow: inset 2px 2px 4px var(--color-shadow-dark), inset -2px -2px 4px var(--color-shadow-light) !important;
             cursor: not-allowed !important;
             transform: none !important;
             opacity: 0.7 !important;
        }
        .letter-bank-btn.correct-form:disabled { background-color: var(--color-correct-light) !important; color: var(--color-correct) !important; box-shadow: inset 2px 2px 4px #5cb58f, inset -2px -2px 4px #8cf9c1 !important; opacity: 0.8 !important; }


        #gameFooter { text-align: center; flex-shrink: 0; padding-top: 0.8rem; margin-top: 0.5rem; border-top: none; display: flex; justify-content: space-between; align-items: center; width: 100%; padding-left: 0; padding-right: 0;
            max-width: 45rem; margin-left: auto; margin-right: auto;
        }


        #pointsBurst { position: absolute; top: 0.5rem; left: 5.5rem; font-size: 1.2rem; font-weight: bold; color: var(--color-score); opacity: 0; pointer-events: none; white-space: nowrap; background: var(--color-bg); padding: 0.3rem 0.6rem; border-radius: 5px; box-shadow: 2px 2px 4px rgba(0,0,0,0.1); }
        #pointsBurst.active { animation: points-burst 0.8s ease-out forwards; }
        @keyframes points-burst { 0% { transform: translateY(0) scale(0.8); opacity: 1; } 50% { transform: translateY(-15px) scale(1.1); opacity: 0.9; } 100% { transform: translateY(-30px) scale(0.9); opacity: 0; } }

        #scoreScreen { align-items: center; justify-content: center; text-align: center; padding: 1.5rem; }
        #scoreScreen h2 { font-size: 2.5rem; color: var(--color-accent-1); margin-bottom: 1rem; text-shadow: 1px 1px 2px var(--color-shadow-dark);}
        #scoreScreen p { font-size: 1.8rem; color: var(--color-text-primary); margin-bottom: 1.5rem; }
        #finalScoreValue { font-weight: bold; color: var(--color-score); } #totalPossibleScore { color: var(--color-text-secondary); }

        #incorrectList { width: 100%; max-width: 25rem; margin-top: 1rem; border-top: 1px solid var(--color-shadow-dark); padding-top: 1rem; text-align: left; }
        #incorrectList h3 { font-size: 1.3rem; color: var(--color-error); margin-bottom: 0.5rem; text-align: center; }
        #incorrectList ul { list-style: none; padding: 0; margin: 0; max-height: 150px; overflow-y: auto; }
        #incorrectList li { font-size: 1.1rem; color: var(--color-text-primary); padding: 0.3rem 0.5rem; border-bottom: 1px dashed var(--color-shadow-dark); display: flex; justify-content: space-between; align-items: center; }
        #incorrectList li span:first-child { font-size: 1rem; color: var(--color-text-secondary); }
        #incorrectList li span:last-child { font-family: var(--font-harmattan); font-size: 1.5rem; font-weight: bold; margin-left: 0.5rem; direction: rtl; }

        /* Media Query'ler kaldƒ±rƒ±ldƒ± */

    </style>
</head>
<body>

    <div id="homeScreen" class="screen active">
         <div class="title-container">
            <div class="title-text">
                <h1>Dinle Ve Yaz!</h1>
                <h2>ÿßŸêÿ≥Ÿíÿ™ŸéŸÖŸêÿπŸí ŸàŸéÿßŸÉŸíÿ™Ÿèÿ®Ÿí</h2>
            </div>
        </div>
        <h3>Seviyeler</h3>
        <div id="levelSelect" class="button-grid">
            <button class="level-btn key-button" data-level="1">Seviye 1</button>
            <button class="level-btn key-button" data-level="2">Seviye 2</button>
            <button class="level-btn key-button" data-level="3">Seviye 3</button>
            <button class="level-btn key-button" data-level="4">Seviye 4</button>
            <button class="level-btn key-button" data-level="5">Seviye 5</button>
            <button class="level-btn key-button" data-level="6">Seviye 6</button>
            <button class="level-btn key-button" data-level="7">Seviye 7</button>
            <button class="level-btn key-button" data-level="8">Seviye 8</button>
        </div>
        </div>

    <div id="gameScreen" class="screen">
        <header id="gameHeader" class="game-header">
            <div id="levelScoreDisplay" class="header-info">Puan: 0</div>
            <div id="pointsBurst"></div>
            <div id="mistakeCounter" class="header-info"></div>
            <div id="timerDisplay" class="header-info">‚è±Ô∏è--s</div>
        </header>

        <main id="gameMain" class="game-main">
            <div id="gameContent">
                <div id="arabicOutputContainer">
                    <div id="arabicOutputDisplay" class="arabic-output empty" dir="rtl" lang="ar"></div>
                </div>
                <div id="letterBankContainer">
                   <div id="letterBank"></div>
                </div>
                <div id="turkishWord">Kelime</div>
            </div>
        </main>

        <footer id="gameFooter" class="game-footer">
            <button id="backToHomeButton" class="back-button key-button">‚¨ÖÔ∏è</button>
            <div id="audioControl">
                 <button id="playAudioButton" class="key-button">üéß</button>
            </div>
        </footer>
    </div>

    <div id="scoreScreen" class="screen">
        <h2 id="scoreTitle">Seviye Tamamlandƒ±!</h2>
        <p id="singlePlayerScoreText">
            Puanƒ±nƒ±z: <span id="finalScoreValue">0</span> / <span id="totalPossibleScore">100</span>
        </p>
        <div id="incorrectList" style="display: none;">
            <h3>Yanlƒ±≈ü Kelimeler:</h3>
            <ul id="incorrectWordsUl"></ul>
        </div>
        <button id="scoreToHomeButton" class="action-btn key-button">Ana Men√º</button>
    </div>

    <script>
        const gameData = {
             1: { timePerLetter: 8, words: [ { ar: "ŸÜŸéÿπŸéŸÖŸí", base_ar:"ŸÜÿπŸÖ", tr: "Evet" }, { ar: "ŸÇŸéŸÑŸéŸÖŸç", base_ar:"ŸÇŸÑŸÖ", tr: "Kalem" }, { ar: "ŸÑŸéÿπŸêÿ®Ÿé", base_ar:"ŸÑÿπÿ®", tr: "Oyun oynama" }, { ar: "ÿπŸéŸÖŸéŸÑŸå", base_ar:"ÿπŸÖŸÑ", tr: "√áalƒ±≈üma" }, { ar: "ŸÅŸéÿ¥ŸéŸÑŸå", base_ar:"ŸÅÿ¥ŸÑ", tr: "Ba≈üarƒ±sƒ±zlƒ±k" }, { ar: "ŸÉŸéÿ≥ŸéŸÑŸå", base_ar:"ŸÉÿ≥ŸÑ", tr: "Tembellik" }, { ar: "ÿ∞ŸéŸáŸéÿ®Ÿç", base_ar:"ÿ∞Ÿáÿ®", tr: "Altƒ±n" }, { ar: "ÿ≥ŸéŸÖŸéŸÉŸç", base_ar:"ÿ≥ŸÖŸÉ", tr: "Balƒ±k" }, { ar: "ŸáŸèŸàŸé", base_ar:"ŸáŸà", tr: "O - erkek" }, { ar: "ŸáŸêŸäŸé", base_ar:"ŸáŸä", tr: "O - kƒ±z" }, { ar: "ŸÖŸêŸÜŸí", base_ar:"ŸÖŸÜ", tr: "-den, -dan" } ] },
             2: { timePerLetter: 7, words: [ { ar: "ŸáŸèŸàŸé", base_ar:"ŸáŸà", tr: "O" }, { ar: "ŸáŸêŸäŸé", base_ar:"ŸáŸä", tr: "O" }, { ar: "ÿπŸéŸÜŸí", base_ar:"ÿπŸÜ", tr: "hakkƒ±nda" }, { ar: "ŸÑŸéŸÖŸí", base_ar:"ŸÑŸÖ", tr: "-medi, -madƒ±" }, { ar: "ŸÜŸéÿπŸéŸÖŸí", base_ar:"ŸÜÿπŸÖ", tr: "Evet" }, { ar: "ÿ¨ŸéŸÑŸéÿ≥Ÿé", base_ar:"ÿ¨ŸÑÿ≥", tr: "Oturdu" }, { ar: "ŸÉŸéÿ™Ÿéÿ®Ÿé", base_ar:"ŸÉÿ™ÿ®", tr: "Yazdƒ±" }, { ar: "ÿ∞ŸéŸáŸéÿ®Ÿå", base_ar:"ÿ∞Ÿáÿ®", tr: "Altƒ±n" }, { ar: "ÿ®Ÿéÿ≠Ÿíÿ±Ÿå", base_ar:"ÿ®ÿ≠ÿ±", tr: "Deniz" }, { ar: "ŸÖŸéÿ∑Ÿíÿ®ŸéÿÆŸå", base_ar:"ŸÖÿ∑ÿ®ÿÆ", tr: "Mutfak" }, { ar: "ŸäŸéŸÉŸíÿ™Ÿèÿ®Ÿè", base_ar:"ŸäŸÉÿ™ÿ®", tr: "Yazƒ±yor" }, { ar: "ŸäŸéÿ∫Ÿíÿ≥ŸêŸÑŸè", base_ar:"Ÿäÿ∫ÿ≥ŸÑ", tr: "Yƒ±kƒ±yor" } ] },
             3: { timePerLetter: 6, words: [ { ar: "ŸÑŸéÿß", base_ar:"ŸÑ", tr: "Hayƒ±r" }, { ar: "ÿ£ŸéŸÜŸéÿß", base_ar:"ÿßŸÜÿß", tr: "Ben" }, { ar: "ÿ®Ÿéÿßÿ®Ÿå", base_ar:"ÿ®ÿßÿ®", tr: "Kapƒ±" }, { ar: "ŸáŸèŸÜŸéÿß", base_ar:"ŸáŸÜ", tr: "Burada" }, { ar: "ÿÆŸéÿßÿ±Ÿêÿ¨Ÿãÿß", base_ar:"ÿÆÿ±ÿ¨", tr: "Dƒ±≈üƒ±nda" }, { ar: "ŸäŸéÿ¥Ÿíÿ±Ÿéÿ®Ÿè", base_ar:"Ÿäÿ¥ÿ±ÿ®", tr: "ƒ∞√ßiyor" }, { ar: "ŸäŸéÿ∫Ÿíÿ≥ŸêŸÑŸè", base_ar:"Ÿäÿ∫ÿ≥ŸÑ", tr: "Yƒ±kƒ±yor" }, { ar: "ÿ∫Ÿéÿ≥ŸéŸÑŸé", base_ar:"ÿ∫ÿ≥ŸÑ", tr: "Yƒ±kadƒ±" }, { ar: "ŸÜŸéÿπŸéŸÖŸí", base_ar:"ŸÜÿπŸÖ", tr: "Evet" }, { ar: "ŸÇŸéŸÑŸéŸÖŸç", base_ar:"ŸÇŸÑŸÖ", tr: "Kalem" }, { ar: "ÿ≥ŸéŸÖŸéŸÉŸå", base_ar:"ÿ≥ŸÖk", tr: "Balƒ±k" }, { ar: "ÿ£ŸéŸÜŸí", base_ar:"ÿßŸÜ", tr: "-mek, mak" }, { ar: "ÿ•ŸêŸÜŸí", base_ar:"ÿßŸÜ", tr: "-se, -sa" } ] },
             4: { timePerLetter: 5, words: [ { ar: "ŸÅŸêŸä", base_ar:"ŸÅŸä", tr: "i√ßinde, -da, -da" }, { ar: "ŸÖŸéÿπŸãÿß", base_ar:"ŸÖÿπ", tr: "Beraber" }, { ar: "ÿπŸêŸÜŸíÿØŸé", base_ar:"ÿπŸÜÿØ", tr: "var, yanƒ±nda" }, { ar: "ÿµŸéŸÅŸåŸë", base_ar:"ÿµŸÅ", tr: "Sƒ±nƒ±f" }, { ar: "ŸÖŸéÿÆŸíÿ±Ÿéÿ¨Ÿå", base_ar:"ŸÖÿÆÿ±ÿ¨", tr: "√áƒ±kƒ±≈ü yeri" }, { ar: "ŸäŸéŸÜŸéÿßŸÖŸè", base_ar:"ŸäŸÜŸÖ", tr: "Uyuyor" }, { ar: "ŸáŸèŸàŸé", base_ar:"ŸáŸà", tr: "O" }, { ar: "ŸäŸéÿ¨ŸíŸÑŸêÿ≥Ÿè", base_ar:"Ÿäÿ¨ŸÑÿ≥", tr: "Oturuyor" }, { ar: "ŸäŸéŸÇŸíÿ±Ÿéÿ£Ÿè", base_ar:"ŸäŸÇÿ±", tr: "Okuyor" }, { ar: "ŸäŸéŸÑŸíÿπŸéÿ®Ÿè", base_ar:"ŸäŸÑÿπÿ®", tr: "Oynuyor" }, { ar: "ŸäŸéÿØŸíÿ±Ÿèÿ≥Ÿè", base_ar:"ŸäÿØÿ±ÿ≥", tr: "Ders √áalƒ±≈üƒ±yor" }, { ar: "ŸäŸéŸÅŸíÿ™Ÿéÿ≠Ÿè", base_ar:"ŸäŸÅÿ™ÿ≠", tr: "A√ßƒ±yor" }, { ar: "ŸäŸéÿ≠ŸíŸÖŸêŸÑŸè", base_ar:"Ÿäÿ≠ŸÖŸÑ", tr: "Ta≈üƒ±yor" } ] },
             5: { timePerLetter: 4, words: [ { ar: "ÿßŸêÿ≥Ÿíÿ™ŸéŸÖŸêÿπŸä", base_ar:"ÿßÿ≥ÿ™ŸÖÿπ", tr: "Dinle - kƒ±z" }, { ar: "ÿ™Ÿéÿ¥Ÿéÿ±ŸéŸëŸÅŸíÿ™Ÿè", base_ar:"ÿ™ÿ¥ÿ±ŸÅÿ™", tr: "Tanƒ±≈ütƒ±ƒüƒ±ma memnun oldum" }, { ar: "ÿπŸéŸÑŸéŸäŸíŸÉŸèŸÖŸí", base_ar:"ÿπŸÑŸäŸÉŸÖ", tr: "√ºzerinize olsun" }, { ar: "ŸàŸéÿ≥ŸéŸáŸíŸÑŸãÿß", base_ar:"Ÿàÿ≥ŸáŸÑ", tr: "Ho≈ü geldiniz" }, { ar: "ÿßŸÑŸíŸÄÿ≠ŸéŸÖŸíÿØ", base_ar:"ÿßŸÑÿ≠ŸÖÿØ", tr: "Hamd" }, { ar: "ÿßŸêÿ≠Ÿíÿ™Ÿéÿ±ŸêŸÖŸí", base_ar:"ÿßÿ≠ÿ™ÿ±ŸÖ", tr: "Saygƒ± duy!" }, { ar: "ÿßŸÉŸíÿ™Ÿèÿ®Ÿä", base_ar:"ÿßŸÉÿ™ÿ®", tr: "Yaz - kƒ±z" }, { ar: "ÿ£ŸéÿπŸêŸäÿØŸä", base_ar:"ÿßÿπŸäÿØ", tr: "Tekrar et - kƒ±z" }, { ar: "ÿ™Ÿéÿπÿßÿ±ŸèŸÅ", base_ar:"ÿ™ÿπÿ±ŸÅ", tr: "Tanƒ±≈üma" }, { ar: "ÿµŸéÿ®Ÿéÿßÿ≠", base_ar:"ÿµÿ®ÿ≠", tr: "Sabah" }, { ar: "ŸÖŸéÿ≥Ÿéÿßÿ°Ÿã", base_ar:"ŸÖÿ≥", tr: "Ak≈üam" } ] },
             6: { timePerLetter: 4, words: [ { ar: "ŸäŸéÿ≥Ÿíÿ™ŸéŸäŸíŸÇŸêÿ∏Ÿè", base_ar:"Ÿäÿ≥ÿ™ŸäŸÇÿ∏", tr: "Uyanƒ±yor" }, { ar: "ŸäŸéÿ≥Ÿíÿ™Ÿéÿ±ŸêŸäÿ≠Ÿè", base_ar:"Ÿäÿ≥ÿ™ÿ±ÿ≠", tr: "Dinleniyor" }, { ar: "ÿßŸèÿØŸíÿ±ŸèsŸêŸä", base_ar:"ÿßÿØÿ±ÿ≥", tr: "Ders √ßalƒ±≈ü!" }, { ar: "ÿßŸêÿ™ŸéŸëŸÅŸéŸÇŸíŸÜŸéÿß", base_ar:"ÿßÿ™ŸÅŸÇ", tr: "Anla≈ütƒ±k!" }, { ar: "ŸÖŸéÿ±Ÿíÿ≠Ÿéÿ®Ÿãÿß", base_ar:"ŸÖÿ±ÿ≠ÿ®", tr: "Merhaba" }, { ar: "ÿ≥ŸéŸÑŸéÿßŸÖŸç", base_ar:"ÿ≥ŸÑŸÖ", tr: "Esenlik" }, { ar: "ÿßŸêÿ®Ÿíÿ™ŸéÿπŸêÿØŸí", base_ar:"ÿßÿ®ÿ™ÿπÿØ", tr: "Uzakla≈ü!" }, { ar: "ÿßŸèÿ±Ÿíÿ≥ŸèŸÖŸêŸä", base_ar:"ÿßÿ±ÿ≥ŸÖ", tr: "Resim yap!" }, { ar: "ÿ™Ÿéÿ≠ŸêŸäŸéŸëÿ©", base_ar:"ÿ™ÿ≠Ÿäÿ©", tr: "Selamla≈üma" }, { ar: "ŸäŸéŸÇŸèŸàŸÖŸè", base_ar:"ŸäŸÇŸàŸÖ", tr: "Kalkƒ±yor" }, { ar: "ÿØŸéŸÅŸíÿ™Ÿéÿ±Ÿç", base_ar:"ÿØŸÅÿ™ÿ±", tr: "Defter" }, { ar: "ÿ∑Ÿéÿ®ŸíÿπŸãÿß", base_ar:"ÿ∑ÿ®ÿπ", tr: "Peki, tabii!" }, { ar: "ŸÖŸéŸÉŸíÿ™Ÿéÿ®Ÿå", base_ar:"ŸÖŸÉÿ™ÿ®", tr: "Masa" } ] },
             7: { timePerLetter: 3, words: [ { ar: "ŸäŸéÿ™Ÿéÿ≠ŸéÿØŸéŸëÿ´ŸèŸàŸÜ", base_ar:"Ÿäÿ™ÿ≠ÿØÿ´", tr: "Konu≈üuyorlar" }, { ar: "ŸäŸéÿ™ŸéÿπŸéÿßŸàŸéŸÜŸèŸàŸÜ", base_ar:"Ÿäÿ™ÿπÿßŸàŸÜ", tr: "Yardƒ±mla≈üƒ±yorlar" }, { ar: "ŸäŸéÿ±Ÿíÿ¨ŸêÿπŸèŸàŸÜ", base_ar:"Ÿäÿ±ÿ¨ÿπ", tr: "D√∂n√ºyorlar" }, { ar: "ŸÖŸéÿ¥Ÿíÿ±ŸèŸàÿ®Ÿéÿßÿ™", base_ar:"ŸÖÿ¥ÿ±Ÿàÿ®", tr: "ƒ∞√ßecekler" }, { ar: "ÿ™ŸéŸÉŸéŸÑŸéŸëŸÖŸíÿ™Ÿè", base_ar:"ÿ™ŸÉŸÑŸÖ", tr: "Konu≈ütum" }, { ar: "ÿßŸêÿ≥Ÿíÿ™ŸéŸÖŸêcŸêŸä", base_ar:"ÿßÿ≥ÿ™ŸÖÿπ", tr: "Dinle" }, { ar: "ŸÑŸéŸäŸíŸÑŸéÿ©", base_ar:"ŸÑŸäŸÑ", tr: "Gece" }, { ar: "ÿ∏ŸèŸáŸíÿ±Ÿå", base_ar:"ÿ∏Ÿáÿ±", tr: "√ñƒüle" }, { ar: "ŸàŸéÿ¨ŸíŸáŸå", base_ar:"Ÿàÿ¨Ÿá", tr: "Y√ºz" }, { ar: "ÿ£ŸèŸÜŸéÿ∏ŸêŸëŸÅŸè", base_ar:"ÿßŸÜÿ∏ŸÅ", tr: "Temizliyorum" }, { ar: "ÿ£Ÿèÿ±Ÿéÿßÿ¨ŸêÿπŸè", base_ar:"ÿßÿ±ÿßÿ¨ÿπ", tr: "Tekrar ediyorum" }, { ar: "ÿßŸéŸÑŸíŸàŸéÿØŸéÿßÿπ", base_ar:"ÿßŸÑŸàÿØÿßÿπ", tr: "Vedala≈ümak" }, { ar: "ÿ∑ŸéÿßŸÑŸêÿ®Ÿå", base_ar:"ÿ∑ÿßŸÑÿ®", tr: "Erkek √∂ƒürenci" }, { ar: "ŸÉŸêÿ™Ÿéÿßÿ®Ÿå", base_ar:"ŸÉÿ™ÿ®", tr: "Kitap" } ] },
             8: { timePerLetter: 3, words: [ { ar: "ŸÖŸèÿπŸéŸÑŸêŸëŸÖŸéÿßÿ™", base_ar:"ŸÖÿπŸÑŸÖ", tr: "√ñƒüretmenler" }, { ar: "ŸÖŸéÿ£ŸíŸÉŸèŸàŸÑŸéÿßÿ™", base_ar:"ŸÖÿßŸÉŸàŸÑ", tr: "Yiyecekler" }, { ar: "ŸäŸéŸÑŸíÿπŸéÿ®ŸèŸàŸÜ", base_ar:"ŸäŸÑÿπÿ®", tr: "Oynuyorlar" }, { ar: "ÿ™ŸêŸÑŸíŸÅŸéÿßÿ≤Ÿå", base_ar:"ÿ™ŸÑŸÅÿ≤", tr: "Televizyon" }, { ar: "ŸÖŸéŸÑŸéÿßÿ®Ÿêÿ≥Ÿç", base_ar:"ŸÖŸÑÿ®ÿ≥", tr: "Elbiseler" }, { ar: "ŸÜŸêÿ∏ŸéÿßŸÖŸå", base_ar:"ŸÜÿ∏ŸÖ", tr: "D√ºzen" }, { ar: "ŸÖŸèÿ®ŸéŸÉŸêŸëÿ±Ÿãÿß", base_ar:"ŸÖÿ®ŸÉÿ±", tr: "Erken" }, { ar: "ÿßŸêÿ≥Ÿíÿ™Ÿêÿ±Ÿéÿßÿ≠Ÿéÿ©", base_ar:"ÿßÿ≥ÿ™ÿ±ÿ≠", tr: "Dinlenmek" }, { ar: "ÿ£Ÿéÿ™ŸéŸÜŸéÿßŸàŸéŸÑŸè", base_ar:"ÿßÿ™ŸÜÿßŸàŸÑ", tr: "Yiyorum" }, { ar: "ÿ™ŸéÿπŸéŸÑŸéŸëŸÖŸíÿ™Ÿè", base_ar:"ÿ™ÿπŸÑŸÖ", tr: "√ñƒürendim" }, { ar: "ŸÖŸèÿØŸéÿ±ŸêŸëÿ≥Ÿéÿ©", base_ar:"ŸÖÿØÿ±ÿ≥", tr: "√ñƒüretmen" }, { ar: "ŸäŸèÿµŸéŸÑŸêŸëŸä", base_ar:"ŸäÿµŸÑ", tr: "Namaz kƒ±lƒ±yor" }, { ar: "ŸäŸèŸÜŸéÿ∏ŸêŸëŸÅŸè", base_ar:"ŸäŸÜÿ∏ŸÅ", tr: "Temizliyor" }, { ar: "ÿ¨ŸéŸÖŸêŸäŸÑŸå", base_ar:"ÿ¨ŸÖŸäŸÑ", tr: "G√ºzel" }, { ar: "ÿ∑ŸéÿßŸàŸêŸÑŸéÿ©", base_ar:"ÿ∑ÿßŸàŸÑ", tr: "Masa" }, { ar: "ŸäŸéÿÆŸíÿ±Ÿèÿ¨Ÿè", base_ar:"ŸäÿÆÿ±ÿ¨", tr: "√áƒ±kƒ±yor" } ] }
        };

        Object.keys(gameData).forEach(level => {
            const levelData = gameData[level];
            if (levelData.words && Array.isArray(levelData.words)) {
                levelData.words.forEach((word, index) => {
                    const voiceNumber = index + 1;
                    word.audioSrc = `l${level}v${voiceNumber}.wav`;
                });
            }
        });
        console.log("Game data updated with audio sources:", gameData);

        // --- DOM Elementleri ---
        const homeScreen = document.getElementById('homeScreen');
        const gameScreen = document.getElementById('gameScreen');
        const scoreScreen = document.getElementById('scoreScreen');
        const levelSelect = document.getElementById('levelSelect');
        const backToHomeButton = document.getElementById('backToHomeButton');
        const scoreToHomeButton = document.getElementById('scoreToHomeButton');
        const timerDisplay = document.getElementById('timerDisplay');
        const gameHeader = document.getElementById('gameHeader');
        const gameMain = document.getElementById('gameMain');
        const gameFooter = document.getElementById('gameFooter');
        const levelScoreDisplay = document.getElementById('levelScoreDisplay');
        const pointsBurst = document.getElementById('pointsBurst');
        const mistakeCounter = document.getElementById('mistakeCounter');
        const playAudioButton = document.getElementById('playAudioButton');
        const turkishWordEl = document.getElementById('turkishWord');
        const arabicOutputEl = document.getElementById('arabicOutputDisplay');
        const arabicOutputContainer = document.getElementById('arabicOutputContainer');
        const letterBankContainer = document.getElementById('letterBankContainer');
        const letterBank = document.getElementById('letterBank');
        const audioControl = document.getElementById('audioControl');
        const scoreTitle = document.getElementById('scoreTitle');
        const singlePlayerScoreText = document.getElementById('singlePlayerScoreText');
        const finalScoreValueEl = document.getElementById('finalScoreValue');
        const totalPossibleScoreEl = document.getElementById('totalPossibleScore');
        const incorrectListEl = document.getElementById('incorrectList');
        const incorrectWordsUlEl = document.getElementById('incorrectWordsUl');

        // --- Oyun Durum Deƒüi≈ükenleri ---
        let selectedLevel = null;
        let currentWordIndex = 0;
        let levelWords = [], currentWord = {}, timerInterval, remainingTime = 0;
        let selectedLevelBtn = null;
        let gameActive = false;
        let wordActive = false;
        let autoNextTimeout;
        let audio = new Audio();
        let waitingForAudioClick = false;
        let selection = [];
        let expectedFullCharIndex = 0;
        let mistakesMade = 0;
        let mistakesAllowed = 3;
        let currentLevelScore = 0;
        let incorrectWords = [];
        let basePointsPerWord = 0;
        let pointsRemainder = 0;
        const shadda = 'Ÿë';
        const shortVowels = ['Ÿé', 'Ÿê', 'Ÿè', 'Ÿã', 'Ÿç', 'Ÿå', 'Ÿí'];
        let fullWordChars = [];

        // --- Fonksiyonlar ---
         function playAudio() {
             console.log("playAudio called. Word object:", currentWord);
             if (!currentWord || !currentWord.audioSrc) { console.warn("No currentWord or audioSrc set."); return; }
             if (!audio.paused) { audio.pause(); audio.currentTime = 0; }
             audio.src = currentWord.audioSrc;
             console.log("Attempting to play audio:", audio.src);
             const playPromise = audio.play();
             if (playPromise !== undefined) {
                 playPromise.catch(e => console.error("Audio playback error:", e))
                          .then(() => console.log("Playback started for:", audio.src));
             }
         }

        function triggerPointsBurst(points) {
            if (!pointsBurst) return;
            pointsBurst.textContent = `+${points} Puan!`;
            pointsBurst.classList.add('active');
            setTimeout(() => pointsBurst.classList.remove('active'), 800);
        }

        function registerMistake(buttonRef) {
             if (!wordActive || mistakesMade >= mistakesAllowed) return;
             mistakesMade++;
             updateMistakeDisplay();
             if (buttonRef) {
                  buttonRef.classList.add('error-form');
                  setTimeout(() => buttonRef.classList.remove('error-form'), 300);
             }
             if (mistakesMade >= mistakesAllowed) {
                  console.log("Hata hakkƒ± bitti!");
                  checkAnswer(true);
             }
        }
         function updateMistakeDisplay() {
             let hearts = '';
             for (let i = 0; i < mistakesAllowed - mistakesMade; i++) { hearts += '‚ù§Ô∏è '; }
             for (let i = 0; i < mistakesMade; i++) { hearts += 'üñ§ '; }
             mistakeCounter.textContent = hearts.trim() || 'üñ§';
         }

        levelSelect.addEventListener('click', (e) => {
            if (e.target.classList.contains('level-btn')) {
                if (selectedLevelBtn) { selectedLevelBtn.classList.remove('selected'); }
                selectedLevel = e.target.dataset.level;
                selectedLevelBtn = e.target;
                selectedLevelBtn.classList.add('selected');
                console.log("Level selected:", selectedLevel);
                startGame();
            }
        });

        function startGame() {
            const gameMode = 'single';
            console.log(`Starting game - Level: ${selectedLevel}, Mode: ${gameMode}`);
            clearTimeout(autoNextTimeout);

            if (!gameData[selectedLevel] || !gameData[selectedLevel].words) {
                console.error(`Oyun verisi bulunamadƒ±! Seviye: ${selectedLevel}`);
                if (selectedLevelBtn) { selectedLevelBtn.classList.remove('selected'); }
                return;
            }

            currentWordIndex = 0;
            levelWords = [...gameData[selectedLevel].words].sort(() => Math.random() - 0.5);

            currentLevelScore = 0;
            incorrectWords = [];
            const numWords = levelWords.length;
            basePointsPerWord = Math.floor(100 / numWords);
            pointsRemainder = 100 % numWords;

            gameHeader.style.display = 'flex';
            gameMain.style.display = 'flex';
            gameFooter.style.display = 'flex';
            levelScoreDisplay.textContent = `Puan: 0`;
            mistakeCounter.style.display = 'block';

            homeScreen.classList.remove('active');
            scoreScreen.classList.remove('active');
            gameScreen.classList.add('active');

            history.pushState({ screen: 'game', mode: gameMode, level: selectedLevel }, '', '#game');

            loadWord();
        }

        function loadWord() {
            clearTimeout(autoNextTimeout);
            wordActive = false;

            if (currentWordIndex >= levelWords.length) { showScoreScreen(); return; }

            currentWord = levelWords[currentWordIndex];
            originalWord = currentWord.ar;
            fullWordChars = Array.from(originalWord).map((char, index) => ({ char: char, id: `${char}-${index}` }));
            const letterCount = Array.from(originalWord).length;
            remainingTime = letterCount * gameData[selectedLevel].timePerLetter;
            timerDisplay.textContent = `‚è±Ô∏è${remainingTime}s`;
            clearInterval(timerInterval);

            turkishWordEl.textContent = currentWord.tr;
            selection = []; expectedFullCharIndex = 0; mistakesMade = 0;
            arabicOutputEl.textContent = ''; arabicOutputEl.classList.add('empty');
            arabicOutputContainer.style.boxShadow = 'inset 3px 3px 6px var(--color-shadow-dark), inset -3px -3px 6px var(--color-shadow-light)';
            populateLetterBank(); disableLetterBank(true); updateMistakeDisplay();

            playAudioButton.disabled = false; playAudioButton.classList.add('blinking-button');
            waitingForAudioClick = true;
        }

        function populateLetterBank() {
            letterBank.innerHTML = '';
            const allChars = Array.from(originalWord);
            const buttonsData = allChars.map((char, index) => ({ char: char, id: `${char}-${index}` }));
            buttonsData.sort(() => Math.random() - 0.5);

            const buttonElements = buttonsData.map(data => {
                const btn = document.createElement('button'); btn.className = 'letter-bank-btn';
                btn.textContent = data.char; btn.dataset.value = data.char; btn.dataset.id = data.id;
                const harekeler = ['Ÿé','Ÿã','Ÿê','Ÿç','Ÿè','Ÿå','Ÿë','Ÿí'];
                if(harekeler.includes(data.char)){
                    btn.classList.add('hareke-char');
                    if(['Ÿé','Ÿã'].includes(data.char)) btn.classList.add('hareke-fatha');
                    else if(['Ÿê','Ÿç'].includes(data.char)) btn.classList.add('hareke-kasra');
                    else btn.classList.add('hareke-normal');
                } else { btn.classList.add('char-only'); }
                return btn;
            });

            buttonElements.forEach(btn => letterBank.appendChild(btn));
        }


        function appendCharToOutput(char) { arabicOutputEl.classList.remove('empty'); arabicOutputEl.textContent += char; }
        function disableLetterBank(disabled) {
            letterBank.querySelectorAll('.letter-bank-btn').forEach(btn => {
                if (btn.classList.contains('correct-form')) { btn.disabled = true; btn.style.opacity = '0.75'; }
                else { btn.disabled = disabled; btn.style.opacity = btn.disabled ? '0.65' : '1'; }
            });
        }
        function disableAllButtons(disabled) { disableLetterBank(disabled); playAudioButton.disabled = disabled; }

        function startTimer() {
            clearInterval(timerInterval); gameActive = true;
            timerInterval = setInterval(() => {
                if (!gameActive) { clearInterval(timerInterval); return; }
                remainingTime--; timerDisplay.textContent = `‚è±Ô∏è${remainingTime}s`;
                if (remainingTime <= 0) {
                    clearInterval(timerInterval); timerDisplay.textContent = '‚è±Ô∏è0s'; gameActive = false; wordActive = false;
                    checkAnswer(true);
                }
            }, 1000);
        }

        function checkAnswer(timeUp = false) {
             if (!wordActive && !waitingForAudioClick) return; wordActive = false; waitingForAudioClick = false; playAudioButton.classList.remove('blinking-button');
             clearTimeout(autoNextTimeout); clearInterval(timerInterval); gameActive = false; disableAllButtons(true);

             const constructedWord = arabicOutputEl.textContent; if(constructedWord === "") arabicOutputEl.classList.add('empty'); else arabicOutputEl.classList.remove('empty');
             const targetWordForCheck = fullWordChars.map(item => item.char).join('');
             const isCorrect = constructedWord.trim() === targetWordForCheck.trim() && !timeUp && mistakesMade < mistakesAllowed;

             if (isCorrect) {
                 let pointsAwarded = basePointsPerWord; if (currentWordIndex < pointsRemainder) { pointsAwarded++; }
                 currentLevelScore += pointsAwarded; levelScoreDisplay.textContent = `Puan: ${currentLevelScore}`; triggerPointsBurst(pointsAwarded);
                 arabicOutputContainer.style.boxShadow = 'inset 3px 3px 6px #5cb58f, inset -3px -3px 6px #8cf9c1';
             } else {
                 arabicOutputContainer.style.boxShadow = 'inset 3px 3px 6px #cc7a7a, inset -3px -3px 6px #ffa0a0';
                 if (!incorrectWords.some(word => word.ar === currentWord.ar)) { incorrectWords.push({ ar: currentWord.ar, tr: currentWord.tr }); }
             }
             const delay = 1500; console.log(`SP: Otomatik ge√ßi≈ü ${delay}ms sonra...`);
             autoNextTimeout = setTimeout(nextWord, delay);
        }


        function nextWord() { if (gameActive || waitingForAudioClick) return; currentWordIndex++; loadWord(); }

        function showScoreScreen() {
            gameActive = false; waitingForAudioClick = false;
            gameScreen.classList.remove('active');
            scoreScreen.classList.add('active');

            scoreTitle.textContent = "Seviye Tamamlandƒ±!"; singlePlayerScoreText.style.display = 'block';
            finalScoreValueEl.textContent = currentLevelScore; totalPossibleScoreEl.textContent = "100";
            incorrectWordsUlEl.innerHTML = '';
            if (incorrectWords.length > 0) {
                incorrectListEl.style.display = 'block';
                incorrectWords.forEach(word => {
                    const li = document.createElement('li');
                    const spanTr = document.createElement('span'); spanTr.textContent = word.tr || '';
                    const spanAr = document.createElement('span'); spanAr.textContent = word.ar || ''; spanAr.setAttribute('dir', 'rtl'); spanAr.setAttribute('lang', 'ar');
                    li.appendChild(spanTr); li.appendChild(spanAr);
                    incorrectWordsUlEl.appendChild(li);
                });
            } else { incorrectListEl.style.display = 'none'; }
        }

        function showHomeScreen() {
            clearTimeout(autoNextTimeout); gameActive = false; wordActive = false; waitingForAudioClick = false; clearInterval(timerInterval);

            gameScreen.classList.remove('active');
            scoreScreen.classList.remove('active');
            homeScreen.classList.add('active');

            history.replaceState({ screen: 'home' }, '', window.location.pathname);
             if (selectedLevelBtn) { selectedLevelBtn.classList.remove('selected'); selectedLevelBtn = null; } selectedLevel = null;
        }

        function highlightExpectedInput(clear = false) { }

        // --- Event Listeners ---
        backToHomeButton.addEventListener('click', showHomeScreen);
        scoreToHomeButton.addEventListener('click', showHomeScreen);

        playAudioButton.addEventListener('click', () => {
            if (waitingForAudioClick) {
                console.log("Audio button clicked (waiting state - starting game)");
                waitingForAudioClick = false;
                wordActive = true;
                playAudioButton.classList.remove('blinking-button');
                playAudio();
                startTimer();
                disableLetterBank(false);
            } else if (wordActive || gameActive) {
                 console.log("Audio button clicked (active/gameActive state - replaying audio)");
                 playAudio();
            } else if (!gameActive && currentWord && currentWord.audioSrc) {
                 console.log("Audio button clicked (inactive state, but word exists - replaying audio)");
                 playAudio();
            } else {
                 console.log("Audio button clicked (inactive state, no word info)");
            }
        });


        letterBank.addEventListener('click', (e) => {
            if (!wordActive) return;
            const clickedButton = e.target.closest('.letter-bank-btn:not(:disabled)');
            if (!clickedButton) return;
            const clickedChar = clickedButton.dataset.value; const clickedId = clickedButton.dataset.id;
             if (expectedFullCharIndex >= fullWordChars.length) { registerMistake(clickedButton); return; }
             const expectedObj = fullWordChars[expectedFullCharIndex];
             if (clickedChar === expectedObj.char) {
                 appendCharToOutput(clickedChar); clickedButton.disabled = true; clickedButton.classList.add('correct-form');
                 expectedFullCharIndex++;
                 if (expectedFullCharIndex === fullWordChars.length) { checkAnswer(false); }
             } else {
                 registerMistake(clickedButton); console.warn(`Harf hatasƒ±. Beklenen: ${expectedObj.char}, Tƒ±klanan: ${clickedChar}`);
             }
         });

        window.addEventListener('popstate', (event) => {
             if (gameScreen.classList.contains('active') || scoreScreen.classList.contains('active')) { console.log("Mobil geri tu≈üu algƒ±landƒ±..."); showHomeScreen(); }
         });

        function initializeApp() {
            document.querySelectorAll('.screen').forEach(screen => {
                screen.classList.remove('active');
            });
            homeScreen.classList.add('active');

            history.replaceState({ screen: 'home' }, '', window.location.pathname);
             selectedLevel = null;
             const modeContainer = document.getElementById('modeSelectContainer');
             if (modeContainer) modeContainer.style.display = 'none';
        }

        initializeApp();
    </script>
</body>
</html>